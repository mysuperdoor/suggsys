"use strict";(self.webpackChunkclient=self.webpackChunkclient||[]).push([[136],{3907:(e,t,s)=>{s.d(t,{A:()=>r});var a=s(94505);const r={getDepartmentStats:async(e,t)=>{try{console.log("\u53d1\u9001\u90e8\u95e8\u7edf\u8ba1\u6570\u636e\u8bf7\u6c42\uff0c\u53c2\u6570:",{startDate:e,endDate:t});const s={};e&&t&&(s.startDate=e,s.endDate=t);const r=await a.A.get("/statistics/department-stats",{params:s});return console.log("\u83b7\u53d6\u90e8\u95e8\u7edf\u8ba1\u6570\u636e\u54cd\u5e94:",r),r&&r.success&&Array.isArray(r.data)?{success:!0,data:r.data}:(console.error("\u90e8\u95e8\u7edf\u8ba1\u6570\u636e\u54cd\u5e94\u683c\u5f0f\u4e0d\u6b63\u786e:",r),{success:!1,data:[],message:"\u6570\u636e\u683c\u5f0f\u4e0d\u6b63\u786e"})}catch(s){throw console.error("\u83b7\u53d6\u90e8\u95e8\u7edf\u8ba1\u6570\u636e\u5931\u8d25:",s.message),s.response?console.error("\u670d\u52a1\u5668\u54cd\u5e94:",s.response.status,s.response.data):s.request&&console.error("\u672a\u6536\u5230\u54cd\u5e94\uff0c\u8bf7\u6c42\u8be6\u60c5:",s.request),s}},getTeamInternalStats:async(e,t,s)=>{try{console.log("\u53d1\u9001\u73ed\u7ec4\u5185\u90e8\u7edf\u8ba1\u6570\u636e\u8bf7\u6c42\uff0c\u53c2\u6570:",{team:e,startDate:t,endDate:s});const r={team:e};t&&s&&(r.startDate=t,r.endDate=s);const n=await a.A.get("/statistics/team-internal-stats",{params:r});return console.log("\u83b7\u53d6\u73ed\u7ec4\u5185\u90e8\u7edf\u8ba1\u6570\u636e\u54cd\u5e94:",n),n&&n.success&&Array.isArray(n.data)?{success:!0,data:n.data}:(console.error("\u73ed\u7ec4\u5185\u90e8\u7edf\u8ba1\u6570\u636e\u54cd\u5e94\u683c\u5f0f\u4e0d\u6b63\u786e:",n),{success:!1,data:[],message:"\u6570\u636e\u683c\u5f0f\u4e0d\u6b63\u786e"})}catch(r){throw console.error("\u83b7\u53d6\u73ed\u7ec4\u5185\u90e8\u7edf\u8ba1\u6570\u636e\u5931\u8d25:",r.message),r.response?console.error("\u670d\u52a1\u5668\u54cd\u5e94:",r.response.status,r.response.data):r.request&&console.error("\u672a\u6536\u5230\u54cd\u5e94\uff0c\u8bf7\u6c42\u8be6\u60c5:",r.request),r}},getDepartmentTrends:async function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"month";try{const s={team:e,period:t};return await a.A.get("/statistics/department-trends",{params:s})}catch(s){throw console.error("\u83b7\u53d6\u90e8\u95e8\u8d8b\u52bf\u6570\u636e\u5931\u8d25:",s),s}},checkApiStatus:async()=>{try{const e=await a.A.checkHealth();if(!e.success)return e;const t=await a.A.get("/statistics/status",{timeout:5e3,showErrorMessage:!1});return{success:!0,status:t.status,message:t.message,time:t.time}}catch(e){return console.error("\u7edf\u8ba1API\u72b6\u6001\u68c0\u67e5\u5931\u8d25:",e),{success:!1,message:e.userMessage||"\u7edf\u8ba1\u670d\u52a1\u4e0d\u53ef\u7528"}}}}},95136:(e,t,s)=>{s.r(t),s.d(t,{default:()=>I});var a=s(65043),r=s(24702),n=s(84892),i=s(48193),l=s(5397),o=s(44394),c=s(85421),d=s(47419),m=s(11645),p=s(64435),u=s(89421),g=s(26655),h=s(98166),y=s(94913),x=s(21218),A=s(3907),b=s(86178),S=s.n(b),j=s(90617),k=s(46237),v=s(39470),C=s(70579);const{RangePicker:w}=r.A,{Text:R}=n.A,f={"\u6700\u8fd1\u4e00\u4e2a\u6708":[S()().subtract(1,"month"),S()()],"\u6700\u8fd1\u4e09\u4e2a\u6708":[S()().subtract(3,"months"),S()()],"\u6700\u8fd1\u534a\u5e74":[S()().subtract(6,"months"),S()()],"\u6700\u8fd1\u4e00\u5e74":[S()().subtract(1,"year"),S()()],"\u5f53\u5e74":[S()().startOf("year"),S()()]},D=[{team:"\u673a\u68b0\u73ed\u7ec4",totalSubmissions:35,approvalRate:85.7,implementationRate:68.5,userCount:12,perCapitaSubmissions:2.9},{team:"\u7535\u6c14\u73ed\u7ec4",totalSubmissions:42,approvalRate:78.6,implementationRate:59.5,userCount:15,perCapitaSubmissions:2.8},{team:"\u4eea\u8868\u73ed\u7ec4",totalSubmissions:28,approvalRate:92.8,implementationRate:75,userCount:10,perCapitaSubmissions:2.8},{team:"\u5b89\u5168\u73ed\u7ec4",totalSubmissions:31,approvalRate:90.3,implementationRate:67.7,userCount:9,perCapitaSubmissions:3.4},{team:"\u8fd0\u884c\u73ed\u7ec4",totalSubmissions:48,approvalRate:83.3,implementationRate:72.9,userCount:20,perCapitaSubmissions:2.4}],I=()=>{const[e,t]=(0,a.useState)(!1),[s,r]=(0,a.useState)([]),[n,b]=(0,a.useState)(null),[I,P]=(0,a.useState)([S()().subtract(1,"month"),S()().add(1,"day")]),[z,F]=(0,a.useState)(!1),[Y,$]=(0,a.useState)({checking:!1,available:null,lastChecked:null,message:null}),M=async()=>{try{$((e=>({...e,checking:!0})));const e=await A.A.checkApiStatus();$({checking:!1,available:e.success,lastChecked:new Date,message:e.message||(e.success?"\u7edf\u8ba1API\u53ef\u7528":"\u7edf\u8ba1API\u4e0d\u53ef\u7528")}),e.success?(i.Ay.success("\u7edf\u8ba1API\u8fde\u63a5\u6210\u529f"),T()):i.Ay.error("\u7edf\u8ba1API\u8fde\u63a5\u5931\u8d25")}catch(n){$({checking:!1,available:!1,lastChecked:new Date,message:n.message||"\u68c0\u67e5API\u72b6\u6001\u65f6\u51fa\u9519"}),i.Ay.error("\u68c0\u67e5API\u72b6\u6001\u5931\u8d25")}},T=async()=>{try{t(!0),b(null);const[e,s]=I,a=await A.A.getDepartmentStats(e.format("YYYY-MM-DD"),s.format("YYYY-MM-DD"));a.success&&Array.isArray(a.data)&&a.data.length>0?(r(a.data),F(!1),!1===Y.available&&$((e=>({...e,available:!0,lastChecked:new Date,message:"\u7edf\u8ba1API\u8fde\u63a5\u6062\u590d"})))):(console.log("API\u8fd4\u56de\u7684\u6570\u636e\u4e3a\u7a7a\u6216\u683c\u5f0f\u4e0d\u6b63\u786e\uff0c\u4f7f\u7528\u6a21\u62df\u6570\u636e",a),r(D),F(!0),b(`\u672a\u80fd\u83b7\u53d6\u771f\u5b9e\u6570\u636e\uff1a${a.message||"\u6570\u636e\u4e3a\u7a7a"}`),i.Ay.warning("\u65e0\u6cd5\u4ece\u670d\u52a1\u5668\u83b7\u53d6\u6570\u636e\uff0c\u663e\u793a\u6a21\u62df\u6570\u636e"))}catch(n){console.error("\u52a0\u8f7d\u7edf\u8ba1\u6570\u636e\u5931\u8d25:",n);let s="\u83b7\u53d6\u62a5\u8868\u6570\u636e\u5931\u8d25";var e;if(n.response)s+=`: ${n.response.status} - ${(null===(e=n.response.data)||void 0===e?void 0:e.message)||"\u672a\u77e5\u9519\u8bef"}`;else n.request?(s+=": \u670d\u52a1\u5668\u672a\u54cd\u5e94\uff0c\u8bf7\u68c0\u67e5\u7f51\u7edc\u8fde\u63a5\u548c\u670d\u52a1\u5668\u72b6\u6001",$({checking:!1,available:!1,lastChecked:new Date,message:"\u670d\u52a1\u5668\u672a\u54cd\u5e94"})):s+=`: ${n.message}`;b(s),r(D),F(!0),i.Ay.error("\u6570\u636e\u52a0\u8f7d\u5931\u8d25\uff0c\u663e\u793a\u6a21\u62df\u6570\u636e")}finally{t(!1)}};(0,a.useEffect)((()=>{T(),M()}),[]),(0,a.useEffect)((()=>{e||T()}),[I]);const q=[{title:"\u73ed\u7ec4/\u79d1\u5ba4",dataIndex:"team",key:"team"},{title:"\u63d0\u4ea4\u603b\u6570",dataIndex:"totalSubmissions",key:"totalSubmissions",sorter:(e,t)=>e.totalSubmissions-t.totalSubmissions},{title:"\u901a\u8fc7\u7387",dataIndex:"approvalRate",key:"approvalRate",render:e=>`${e?e.toFixed(2):0}%`,sorter:(e,t)=>e.approvalRate-t.approvalRate},{title:"\u5b9e\u65bd\u5b8c\u6210\u7387",dataIndex:"implementationRate",key:"implementationRate",render:e=>`${e?e.toFixed(2):0}%`,sorter:(e,t)=>e.implementationRate-t.implementationRate},{title:"\u73ed\u7ec4\u5f97\u5206\u603b\u548c",dataIndex:"totalScore",key:"totalScore",sorter:(e,t)=>(e.totalScore||0)-(t.totalScore||0),render:e=>"number"===typeof e?e.toFixed(1):"-"}],E={data:s,xField:"team",yField:"totalSubmissions",label:{position:"top"},meta:{team:{alias:"\u73ed\u7ec4/\u79d1\u5ba4"},totalSubmissions:{alias:"\u63d0\u4ea4\u603b\u6570"}},height:220},B={data:s.length>0?s.map((e=>[{team:e.team,rate:e.approvalRate||0,type:"\u901a\u8fc7\u7387"},{team:e.team,rate:e.implementationRate||0,type:"\u5b9e\u65bd\u5b8c\u6210\u7387"}])).flat():[],xField:"team",yField:"rate",seriesField:"type",meta:{rate:{formatter:e=>`${e}%`}},height:220};return(0,C.jsx)("div",{className:"department-performance",style:{maxWidth:"1200px",margin:"0 auto"},children:(0,C.jsx)(g.A,{title:"\u62a5\u8868\u7edf\u8ba1",size:"small",bodyStyle:{padding:"12px"},extra:(0,C.jsxs)(p.A,{size:"small",children:[(0,C.jsx)(w,{value:I,onChange:P,allowClear:!1,ranges:f,size:"small"}),(0,C.jsx)(u.A,{icon:(0,C.jsx)(j.A,{}),onClick:T,loading:e,size:"small",children:"\u5237\u65b0"})]}),children:e?(0,C.jsx)(l.A,{tip:"\u52a0\u8f7d\u4e2d...",size:"large",style:{marginTop:60,display:"flex",justifyContent:"center"}}):n&&!z?(0,C.jsx)(o.A,{message:n,type:"error",style:{marginTop:15}}):s&&0!==s.length?(0,C.jsxs)(d.A,{gutter:[12,12],children:[(z||n)&&(0,C.jsx)(m.A,{span:24,children:(0,C.jsx)(o.A,{message:z?"\u5f53\u524d\u663e\u793a\u7684\u662f\u6a21\u62df\u6570\u636e":"\u6570\u636e\u52a0\u8f7d\u51fa\u73b0\u95ee\u9898",description:(0,C.jsxs)("div",{children:[(0,C.jsx)("p",{style:{margin:"8px 0"},children:n||"\u65e0\u6cd5\u4ece\u670d\u52a1\u5668\u83b7\u53d6\u771f\u5b9e\u6570\u636e\uff0c\u5f53\u524d\u663e\u793a\u7684\u662f\u6a21\u62df\u6570\u636e\u3002"}),(0,C.jsxs)(p.A,{children:[(0,C.jsx)(u.A,{type:"primary",size:"small",icon:(0,C.jsx)(j.A,{}),onClick:T,loading:e,children:"\u91cd\u65b0\u52a0\u8f7d\u6570\u636e"}),(0,C.jsx)(u.A,{type:"link",size:"small",onClick:M,loading:Y.checking,children:"\u68c0\u67e5API\u72b6\u6001"})]})]}),type:"warning",showIcon:!0,style:{marginBottom:12}})}),(0,C.jsx)(m.A,{xs:24,lg:12,children:(0,C.jsx)(g.A,{title:(0,C.jsxs)(p.A,{children:[(0,C.jsx)("span",{children:"\u5efa\u8bae\u63d0\u4ea4\u6570\u91cf"}),!0===Y.available&&(0,C.jsxs)(R,{type:"success",children:[(0,C.jsx)(k.A,{})," API\u53ef\u7528"]}),!1===Y.available&&(0,C.jsxs)(R,{type:"danger",children:[(0,C.jsx)(v.A,{})," API\u4e0d\u53ef\u7528"]})]}),size:"small",bordered:!1,bodyStyle:{padding:"8px"},headStyle:{padding:"8px 12px"},extra:(0,C.jsx)(u.A,{icon:(0,C.jsx)(j.A,{}),onClick:T,loading:e,size:"small",children:"\u5237\u65b0"}),children:(0,C.jsx)(y.A,{...E})})}),(0,C.jsx)(m.A,{xs:24,lg:12,children:(0,C.jsx)(g.A,{title:"\u901a\u8fc7\u7387\u548c\u5b9e\u65bd\u5b8c\u6210\u7387\u5bf9\u6bd4",size:"small",bordered:!1,bodyStyle:{padding:"8px"},headStyle:{padding:"8px 12px"},children:(0,C.jsx)(x.A,{...B})})}),(0,C.jsx)(m.A,{span:24,children:(0,C.jsx)(g.A,{title:"\u8be6\u7ec6\u6570\u636e",size:"small",bordered:!1,bodyStyle:{padding:"8px"},headStyle:{padding:"8px 12px"},children:(0,C.jsx)(h.A,{columns:q,dataSource:s,rowKey:"team",loading:e,size:"small",pagination:!1})})})]}):(0,C.jsx)(c.A,{description:"\u6682\u65e0\u6570\u636e",style:{marginTop:30}})})})}}}]);
//# sourceMappingURL=136.b433260a.chunk.js.map