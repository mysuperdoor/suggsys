"use strict";(self.webpackChunkclient=self.webpackChunkclient||[]).push([[553],{68553:(e,t,n)=>{n.r(t),n.d(t,{default:()=>T});var i=n(65043),r=n(94406),s=n(48193),l=n(8387),o=n(64435),d=n(89421),a=n(50289),c=n(47419),u=n(11645),p=n(33307),x=n(98166),S=n(76191),g=n(67407),h=n(35475),m=n(26510),y=n(78816),A=n(73216),f=n(19119),j=n(82437),v=n(81015),w=n(70579);const{Option:E}=r.A,T=()=>{console.log("STATUS_COLORS:",f.STATUS_COLORS);const[e,t]=(0,i.useState)([]),[n,T]=(0,i.useState)(!1),[I,_]=(0,i.useState)({current:1,pageSize:10,total:0}),[L,z]=(0,i.useState)({field:"createdAt",order:"descend"}),[O,b]=(0,i.useState)(""),[C,k]=(0,i.useState)("ALL"),[N,R]=(0,i.useState)("ALL"),[U,W]=(0,i.useState)("ALL"),[D,G]=(0,i.useState)(window.innerWidth<=768),P=y.y.getCurrentUser(),B="\u90e8\u95e8\u7ecf\u7406"===(null===P||void 0===P?void 0:P.role),V=(null===P||void 0===P||P.role,"\u5b89\u5168\u79d1\u7ba1\u7406\u4eba\u5458"===(null===P||void 0===P?void 0:P.role)),Y="\u8fd0\u884c\u79d1\u7ba1\u7406\u4eba\u5458"===(null===P||void 0===P?void 0:P.role),$=(0,A.Zp)(),q=async()=>{T(!0);const e={page:I.current,limit:I.pageSize,sortBy:L.field,sortOrder:"ascend"===L.order?"asc":"desc"};O&&(e.title=O),C&&"ALL"!==C&&(e.type=C),N&&"ALL"!==N&&(e.reviewStatus=N),U&&"ALL"!==U&&(e.implementationStatus=U),Object.keys(e).forEach((t=>null==e[t]&&delete e[t])),console.log("Fetching suggestions with params:",e);try{const n=await m.O.getSuggestions(e);console.log("\u83b7\u53d6\u5230\u7684\u5efa\u8bae\u5217\u8868\u6570\u636e:",n);const{data:i,pagination:r}=n;if(t(i||[]),console.log("\u83b7\u53d6\u5230\u7684\u5efa\u8bae\u6570\u91cf:",(null===i||void 0===i?void 0:i.length)||0),console.log("\u539f\u59cb\u5206\u9875\u4fe1\u606f:",r),r){const e={...I,current:parseInt(r.current)||I.current,pageSize:parseInt(r.pageSize)||I.pageSize,total:parseInt(r.total)||0};console.log("\u66f4\u65b0\u540e\u7684\u5206\u9875\u4fe1\u606f:",e),_(e)}else{const t={...I,total:(null===i||void 0===i?void 0:i.length)||0,current:e.page||I.current};console.log("\u6ca1\u6709\u5206\u9875\u4fe1\u606f\uff0c\u4f7f\u7528\u9ed8\u8ba4\u503c:",t),_(t)}}catch(n){console.error("\u83b7\u53d6\u5efa\u8bae\u5217\u8868\u5931\u8d25:",n),s.Ay.error("\u83b7\u53d6\u5efa\u8bae\u5217\u8868\u5931\u8d25"),t([]),_((e=>({...e,total:0,current:1})))}finally{T(!1)}};(0,i.useEffect)((()=>{q()}),[I.current,I.pageSize,L,O,C,N,U]),(0,i.useEffect)((()=>{const e=()=>{console.log("SuggestionList window focused, refreshing data with current filters..."),q()};return window.addEventListener("focus",e),()=>{window.removeEventListener("focus",e)}}),[]),(0,i.useEffect)((()=>{const e=()=>{G(window.innerWidth<=768)};return window.addEventListener("resize",e),()=>{window.removeEventListener("resize",e)}}),[]);const F=e=>{b(e),_((e=>({...e,current:1})))},M=e=>{$(`/suggestions/${e._id}`)},J=[{title:"\u6807\u9898",dataIndex:"title",key:"title",width:"20%",sorter:!0,render:(e,t)=>(0,w.jsx)(h.N_,{to:`/suggestions/${t._id}`,style:{fontSize:"14px"},children:e})},{title:"\u7c7b\u578b",dataIndex:"type",key:"type",width:"10%",sorter:!0,render:e=>(0,w.jsx)(l.A,{color:f.TYPE_COLORS[e]||"default",style:{padding:"4px 8px",borderRadius:"4px",fontSize:"14px"},children:f.SUGGESTION_TYPES[e]||e})},{title:"\u63d0\u4ea4\u4eba",dataIndex:["submitter","name"],key:"submitter",width:"10%",sorter:!0,render:(e,t)=>(0,w.jsx)("span",{style:{fontSize:"14px"},children:t.submitter?t.submitter.name:"\u672a\u77e5"})},{title:"\u63d0\u4ea4\u65f6\u95f4",dataIndex:"createdAt",key:"createdAt",width:"15%",sorter:!0,render:e=>(0,w.jsx)("span",{style:{fontSize:"14px"},children:e?new Date(e).toLocaleString():"\u672a\u77e5"})},{title:"\u5efa\u8bae\u72b6\u6001",dataIndex:"status",key:"status",width:"10%",sorter:!0,render:(e,t)=>{const n=(0,v.q)(t);console.log("\u72b6\u6001\u6e32\u67d3:",{"\u539f\u59cb\u72b6\u6001":e,"\u5f53\u524d\u72b6\u6001":n,"\u72b6\u6001\u989c\u8272":f.STATUS_COLORS[n],"\u72b6\u6001\u663e\u793a\u6587\u672c":f.REVIEW_STATUS[n]||n});const i=f.STATUS_COLORS[n]||"default";return(0,w.jsx)(l.A,{color:i,style:{padding:"4px 8px",borderRadius:"4px",fontSize:"14px"},children:f.REVIEW_STATUS[n]||n})}},{title:"\u5b9e\u65bd\u72b6\u6001",dataIndex:"implementationStatus",key:"implementationStatus",width:"10%",sorter:!0,render:(e,t)=>{var n;const i=(null===(n=t.implementation)||void 0===n?void 0:n.status)||e||"NOT_STARTED",r=(0,j.Aw)(i,"implementation"),s=(0,j.qY)(i,"implementation");return(0,w.jsx)(l.A,{color:s,style:{padding:"4px 8px",borderRadius:"4px",fontSize:"14px"},children:r})}},{title:"\u5f97\u5206",dataIndex:["scoring","score"],key:"score",width:"8%",sorter:(e,t)=>{var n,i;const r=null===(n=e.scoring)||void 0===n?void 0:n.score,s=null===(i=t.scoring)||void 0===i?void 0:i.score;return void 0!==r&&null!==r&&void 0!==s&&null!==s?r-s:void 0===r||null===r?1:void 0===s||null===s?-1:0},render:e=>(0,w.jsx)("span",{style:{fontSize:"14px",fontWeight:"bold"},children:"number"===typeof e?e.toFixed(1):"-"})},{title:"\u64cd\u4f5c",key:"action",render:(e,t)=>{const n=(0,v.q)(t);return(0,w.jsxs)(o.A,{children:[(0,w.jsx)(d.A,{type:"link",icon:(0,w.jsx)(S.A,{}),onClick:()=>M(t),style:{fontSize:"14px"},children:"\u67e5\u770b"}),B&&"PENDING_FIRST_REVIEW"===n&&(0,w.jsx)(d.A,{type:"link",icon:(0,w.jsx)(g.A,{}),onClick:()=>$(`/suggestions/${t._id}`),style:{fontSize:"14px"},children:"\u4e00\u7ea7\u5ba1\u6838"}),V&&"PENDING_SECOND_REVIEW"===n&&"SAFETY"===t.type&&(0,w.jsx)(d.A,{type:"link",icon:(0,w.jsx)(g.A,{}),onClick:()=>$(`/suggestions/${t._id}`),style:{fontSize:"14px"},children:"\u4e8c\u7ea7\u5ba1\u6838"}),Y&&"PENDING_SECOND_REVIEW"===n&&"SAFETY"!==t.type&&(0,w.jsx)(d.A,{type:"link",icon:(0,w.jsx)(g.A,{}),onClick:()=>$(`/suggestions/${t._id}`),style:{fontSize:"14px"},children:"\u4e8c\u7ea7\u5ba1\u6838"}),B&&"PENDING_SECOND_REVIEW"===n&&(0,w.jsx)(d.A,{type:"link",icon:(0,w.jsx)(g.A,{}),onClick:()=>$(`/suggestions/${t._id}`),style:{fontSize:"14px"},children:"\u4e8c\u7ea7\u5ba1\u6838"})]})}}],K=[{title:"\u6807\u9898",dataIndex:"title",key:"title",render:(e,t)=>{var n;return(0,w.jsxs)("div",{onClick:()=>M(t),style:{cursor:"pointer"},children:[(0,w.jsx)("div",{style:{fontSize:"14px",fontWeight:"bold",marginBottom:"8px"},children:e}),(0,w.jsxs)("div",{style:{display:"flex",flexWrap:"wrap",gap:"4px",marginBottom:"8px"},children:[(0,w.jsx)(l.A,{color:f.TYPE_COLORS[t.type]||"default",style:{padding:"2px 4px",fontSize:"12px"},children:f.SUGGESTION_TYPES[t.type]||t.type}),(()=>{const e=(0,v.q)(t),n=f.STATUS_COLORS[e]||"default";return(0,w.jsx)(l.A,{color:n,style:{padding:"2px 4px",fontSize:"12px"},children:f.REVIEW_STATUS[e]||e})})(),(e=>{const n=(null===(e=t.implementation)||void 0===e?void 0:e.status)||t.implementationStatus||"NOT_STARTED",i=(0,j.Aw)(n,"implementation"),r=(0,j.qY)(n,"implementation");return(0,w.jsx)(l.A,{color:r,style:{padding:"2px 4px",fontSize:"12px"},children:i})})()]}),(0,w.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",fontSize:"12px",color:"#999"},children:[(0,w.jsx)("span",{children:t.submitter?t.submitter.name:"\u672a\u77e5"}),(0,w.jsx)("span",{children:t.createdAt?new Date(t.createdAt).toLocaleDateString():"\u672a\u77e5"}),"number"===typeof(null===(n=t.scoring)||void 0===n?void 0:n.score)&&(0,w.jsxs)("span",{style:{fontWeight:"bold"},children:["\u5f97\u5206: ",t.scoring.score.toFixed(1)]})]})]})}}];return(0,w.jsxs)("div",{className:"responsive-container",style:{padding:"24px"},children:[(0,w.jsx)(a.A,{layout:D?"vertical":"inline",style:{marginBottom:"20px"},children:(0,w.jsxs)(c.A,{gutter:D?8:16,style:{width:"100%"},children:[(0,w.jsx)(u.A,{xs:24,sm:12,md:8,lg:6,xl:5,children:(0,w.jsx)(a.A.Item,{style:{width:"100%",marginBottom:D?"12px":"20px"},label:"\u641c\u7d22",children:(0,w.jsx)(p.A.Search,{placeholder:"\u5efa\u8bae\u6807\u9898...",allowClear:!0,onSearch:F,onChange:e=>{e.target.value||F("")},enterButton:!0})})}),(0,w.jsx)(u.A,{xs:24,sm:12,md:8,lg:6,xl:5,children:(0,w.jsx)(a.A.Item,{style:{width:"100%",marginBottom:D?"12px":"20px"},label:"\u7c7b\u578b",children:(0,w.jsxs)(r.A,{value:C,onChange:e=>{k(e),_((e=>({...e,current:1})))},style:{width:"100%"},placeholder:"\u6240\u6709\u7c7b\u578b",children:[(0,w.jsx)(E,{value:"ALL",children:"\u6240\u6709\u7c7b\u578b"}),Object.entries(f.SUGGESTION_TYPES).map((e=>{let[t,n]=e;return(0,w.jsx)(E,{value:t,children:n},t)}))]})})}),(0,w.jsx)(u.A,{xs:24,sm:12,md:8,lg:6,xl:5,children:(0,w.jsx)(a.A.Item,{style:{width:"100%",marginBottom:D?"12px":"20px"},label:"\u5efa\u8bae\u72b6\u6001",children:(0,w.jsxs)(r.A,{value:N,onChange:e=>{R(e),_((e=>({...e,current:1})))},style:{width:"100%"},placeholder:"\u6240\u6709\u5efa\u8bae\u72b6\u6001",children:[(0,w.jsx)(E,{value:"ALL",children:"\u6240\u6709\u5efa\u8bae\u72b6\u6001"}),Object.entries(f.REVIEW_STATUS).map((e=>{let[t,n]=e;return(0,w.jsx)(E,{value:t,children:n},t)}))]})})}),(0,w.jsx)(u.A,{xs:24,sm:12,md:8,lg:6,xl:5,children:(0,w.jsx)(a.A.Item,{style:{width:"100%",marginBottom:D?"12px":"20px"},label:"\u5b9e\u65bd\u72b6\u6001",children:(0,w.jsxs)(r.A,{value:U,onChange:e=>{W(e),_((e=>({...e,current:1})))},style:{width:"100%"},placeholder:"\u6240\u6709\u5b9e\u65bd\u72b6\u6001",children:[(0,w.jsx)(E,{value:"ALL",children:"\u6240\u6709\u5b9e\u65bd\u72b6\u6001"}),Object.entries(f.IMPLEMENTATION_STATUS).map((e=>{let[t,n]=e;return(0,w.jsx)(E,{value:t,children:n},t)}))]})})})]})}),(0,w.jsx)(x.A,{columns:D?K:J,dataSource:e,rowKey:"_id",pagination:{current:I.current,pageSize:I.pageSize,total:I.total,showSizeChanger:!0,showQuickJumper:!0,showTotal:e=>`\u5171 ${e} \u6761\u5efa\u8bae`},loading:n,onChange:(e,t,n)=>{console.log("Table changed:",e,t,n),_((t=>({...t,current:e.current,pageSize:e.pageSize}))),n&&n.field?z({field:n.field,order:n.order}):z({field:"createdAt",order:"descend"})},style:{fontSize:D?"13px":"14px"},className:"suggestions-table",bordered:!0,rowClassName:()=>"suggestion-row",scroll:{}})]})}},81015:(e,t,n)=>{n.d(t,{q:()=>r});var i=n(19119);const r=e=>{if(!e)return"";const t=e.reviewStatus||e.status;if("string"===typeof t&&/[\u4e00-\u9fa5]/.test(t)){const e=Object.entries(i.REVIEW_STATUS).find((e=>{let[n,i]=e;return i===t}));return e?e[0]:t}return t}}}]);
//# sourceMappingURL=553.5e45f011.chunk.js.map