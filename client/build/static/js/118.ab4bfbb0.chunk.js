"use strict";(self.webpackChunkclient=self.webpackChunkclient||[]).push([[118],{3907:(e,t,a)=>{a.d(t,{A:()=>r});var s=a(94505);const r={getDepartmentStats:async(e,t)=>{try{console.log("\u53d1\u9001\u90e8\u95e8\u7edf\u8ba1\u6570\u636e\u8bf7\u6c42\uff0c\u53c2\u6570:",{startDate:e,endDate:t});const a={};e&&t&&(a.startDate=e,a.endDate=t);const r=await s.A.get("/statistics/department-stats",{params:a});return console.log("\u83b7\u53d6\u90e8\u95e8\u7edf\u8ba1\u6570\u636e\u54cd\u5e94:",r),r&&r.success&&Array.isArray(r.data)?{success:!0,data:r.data}:(console.error("\u90e8\u95e8\u7edf\u8ba1\u6570\u636e\u54cd\u5e94\u683c\u5f0f\u4e0d\u6b63\u786e:",r),{success:!1,data:[],message:"\u6570\u636e\u683c\u5f0f\u4e0d\u6b63\u786e"})}catch(a){throw console.error("\u83b7\u53d6\u90e8\u95e8\u7edf\u8ba1\u6570\u636e\u5931\u8d25:",a.message),a.response?console.error("\u670d\u52a1\u5668\u54cd\u5e94:",a.response.status,a.response.data):a.request&&console.error("\u672a\u6536\u5230\u54cd\u5e94\uff0c\u8bf7\u6c42\u8be6\u60c5:",a.request),a}},getTeamInternalStats:async(e,t,a)=>{try{console.log("\u53d1\u9001\u73ed\u7ec4\u5185\u90e8\u7edf\u8ba1\u6570\u636e\u8bf7\u6c42\uff0c\u53c2\u6570:",{team:e,startDate:t,endDate:a});const r={team:e};t&&a&&(r.startDate=t,r.endDate=a);const n=await s.A.get("/statistics/team-internal-stats",{params:r});return console.log("\u83b7\u53d6\u73ed\u7ec4\u5185\u90e8\u7edf\u8ba1\u6570\u636e\u54cd\u5e94:",n),n&&n.success&&Array.isArray(n.data)?{success:!0,data:n.data}:(console.error("\u73ed\u7ec4\u5185\u90e8\u7edf\u8ba1\u6570\u636e\u54cd\u5e94\u683c\u5f0f\u4e0d\u6b63\u786e:",n),{success:!1,data:[],message:"\u6570\u636e\u683c\u5f0f\u4e0d\u6b63\u786e"})}catch(r){throw console.error("\u83b7\u53d6\u73ed\u7ec4\u5185\u90e8\u7edf\u8ba1\u6570\u636e\u5931\u8d25:",r.message),r.response?console.error("\u670d\u52a1\u5668\u54cd\u5e94:",r.response.status,r.response.data):r.request&&console.error("\u672a\u6536\u5230\u54cd\u5e94\uff0c\u8bf7\u6c42\u8be6\u60c5:",r.request),r}},getDepartmentTrends:async function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"month";try{const a={team:e,period:t};return await s.A.get("/statistics/department-trends",{params:a})}catch(a){throw console.error("\u83b7\u53d6\u90e8\u95e8\u8d8b\u52bf\u6570\u636e\u5931\u8d25:",a),a}},checkApiStatus:async()=>{try{const e=await s.A.checkHealth();if(!e.success)return e;const t=await s.A.get("/statistics/status",{timeout:5e3,showErrorMessage:!1});return{success:!0,status:t.status,message:t.message,time:t.time}}catch(e){return console.error("\u7edf\u8ba1API\u72b6\u6001\u68c0\u67e5\u5931\u8d25:",e),{success:!1,message:e.userMessage||"\u7edf\u8ba1\u670d\u52a1\u4e0d\u53ef\u7528"}}}}},28118:(e,t,a)=>{a.r(t),a.d(t,{default:()=>F});var s=a(65043),r=a(24702),n=a(84892),l=a(94406),o=a(48193),i=a(5397),c=a(44394),d=a(85421),m=a(47419),p=a(11645),u=a(64435),g=a(89421),h=a(26655),y=a(98166),x=a(94913),A=a(21218),S=a(3907),j=a(78816),b=a(86178),k=a.n(b),v=a(90617),f=a(46237),w=a(39470),R=a(70579);const{RangePicker:I}=r.A,{Text:D}=n.A,{Option:C}=l.A,z={"\u6700\u8fd1\u4e00\u4e2a\u6708":[k()().subtract(1,"month"),k()()],"\u6700\u8fd1\u4e09\u4e2a\u6708":[k()().subtract(3,"months"),k()()],"\u6700\u8fd1\u534a\u5e74":[k()().subtract(6,"months"),k()()],"\u6700\u8fd1\u4e00\u5e74":[k()().subtract(1,"year"),k()()],"\u5f53\u5e74":[k()().startOf("year"),k()()]},P=[{name:"\u5f20\u4e09",totalSubmissions:12,approvalRate:83.3,implementationRate:66.7,totalScore:36.5},{name:"\u674e\u56db",totalSubmissions:8,approvalRate:75,implementationRate:62.5,totalScore:24.2},{name:"\u738b\u4e94",totalSubmissions:10,approvalRate:90,implementationRate:70,totalScore:31.8},{name:"\u8d75\u516d",totalSubmissions:6,approvalRate:66.7,implementationRate:50,totalScore:18.3},{name:"\u94b1\u4e03",totalSubmissions:9,approvalRate:88.9,implementationRate:77.8,totalScore:29.4}],F=()=>{const[e,t]=(0,s.useState)(!1),[a,r]=(0,s.useState)([]),[n,l]=(0,s.useState)(null),[b,C]=(0,s.useState)([k()().subtract(1,"month"),k()().add(1,"day")]),[F,Y]=(0,s.useState)(!1),[$,T]=(0,s.useState)(null),[M,q]=(0,s.useState)(null),[E,O]=(0,s.useState)({checking:!1,available:null,lastChecked:null,message:null});(0,s.useEffect)((()=>{(async()=>{try{const e=await j.y.getCurrentUser();e&&e.team&&(q(e.team),T(e.team))}catch(n){console.error("\u83b7\u53d6\u7528\u6237\u4fe1\u606f\u5931\u8d25:",n),o.Ay.error("\u83b7\u53d6\u7528\u6237\u73ed\u7ec4\u4fe1\u606f\u5931\u8d25")}})()}),[]);const B=async()=>{try{O((e=>({...e,checking:!0})));const e=await S.A.checkApiStatus();O({checking:!1,available:e.success,lastChecked:new Date,message:e.message||(e.success?"\u7edf\u8ba1API\u53ef\u7528":"\u7edf\u8ba1API\u4e0d\u53ef\u7528")}),e.success?(o.Ay.success("\u7edf\u8ba1API\u8fde\u63a5\u6210\u529f"),H()):o.Ay.error("\u7edf\u8ba1API\u8fde\u63a5\u5931\u8d25")}catch(n){O({checking:!1,available:!1,lastChecked:new Date,message:n.message||"\u68c0\u67e5API\u72b6\u6001\u65f6\u51fa\u9519"}),o.Ay.error("\u68c0\u67e5API\u72b6\u6001\u5931\u8d25")}},H=async()=>{if($)try{t(!0),l(null);const[e,a]=b,s=await S.A.getTeamInternalStats($,e.format("YYYY-MM-DD"),a.format("YYYY-MM-DD"));s.success&&Array.isArray(s.data)&&s.data.length>0?(r(s.data),Y(!1),!1===E.available&&O((e=>({...e,available:!0,lastChecked:new Date,message:"\u7edf\u8ba1API\u8fde\u63a5\u6062\u590d"})))):(console.log("API\u8fd4\u56de\u7684\u6570\u636e\u4e3a\u7a7a\u6216\u683c\u5f0f\u4e0d\u6b63\u786e\uff0c\u4f7f\u7528\u6a21\u62df\u6570\u636e",s),r(P),Y(!0),l(`\u672a\u80fd\u83b7\u53d6\u771f\u5b9e\u6570\u636e\uff1a${s.message||"\u6570\u636e\u4e3a\u7a7a"}`),o.Ay.warning("\u65e0\u6cd5\u4ece\u670d\u52a1\u5668\u83b7\u53d6\u6570\u636e\uff0c\u663e\u793a\u6a21\u62df\u6570\u636e"))}catch(n){console.error("\u52a0\u8f7d\u7edf\u8ba1\u6570\u636e\u5931\u8d25:",n);let a="\u83b7\u53d6\u62a5\u8868\u6570\u636e\u5931\u8d25";var e;if(n.response)a+=`: ${n.response.status} - ${(null===(e=n.response.data)||void 0===e?void 0:e.message)||"\u672a\u77e5\u9519\u8bef"}`;else n.request?(a+=": \u670d\u52a1\u5668\u672a\u54cd\u5e94\uff0c\u8bf7\u68c0\u67e5\u7f51\u7edc\u8fde\u63a5\u548c\u670d\u52a1\u5668\u72b6\u6001",O({checking:!1,available:!1,lastChecked:new Date,message:"\u670d\u52a1\u5668\u672a\u54cd\u5e94"})):a+=`: ${n.message}`;l(a),r(P),Y(!0),o.Ay.error("\u6570\u636e\u52a0\u8f7d\u5931\u8d25\uff0c\u663e\u793a\u6a21\u62df\u6570\u636e")}finally{t(!1)}else o.Ay.warning("\u672a\u80fd\u83b7\u53d6\u73ed\u7ec4\u4fe1\u606f")};(0,s.useEffect)((()=>{$&&(H(),B())}),[$]),(0,s.useEffect)((()=>{!e&&$&&H()}),[b,$]);const K=[{title:"\u5458\u5de5\u59d3\u540d",dataIndex:"name",key:"name"},{title:"\u63d0\u4ea4\u603b\u6570",dataIndex:"totalSubmissions",key:"totalSubmissions",sorter:(e,t)=>e.totalSubmissions-t.totalSubmissions},{title:"\u901a\u8fc7\u7387",dataIndex:"approvalRate",key:"approvalRate",render:e=>`${e?e.toFixed(2):0}%`,sorter:(e,t)=>e.approvalRate-t.approvalRate},{title:"\u5b9e\u65bd\u5b8c\u6210\u7387",dataIndex:"implementationRate",key:"implementationRate",render:e=>`${e?e.toFixed(2):0}%`,sorter:(e,t)=>e.implementationRate-t.implementationRate},{title:"\u5f97\u5206\u603b\u548c",dataIndex:"totalScore",key:"totalScore",sorter:(e,t)=>(e.totalScore||0)-(t.totalScore||0),render:e=>"number"===typeof e?e.toFixed(1):"-"}],N={data:a,xField:"name",yField:"totalSubmissions",label:{position:"top"},meta:{name:{alias:"\u5458\u5de5\u59d3\u540d"},totalSubmissions:{alias:"\u63d0\u4ea4\u603b\u6570"}},height:220},U={data:a.length>0?a.map((e=>[{name:e.name,rate:e.approvalRate||0,type:"\u901a\u8fc7\u7387"},{name:e.name,rate:e.implementationRate||0,type:"\u5b9e\u65bd\u5b8c\u6210\u7387"}])).flat():[],xField:"name",yField:"rate",seriesField:"type",meta:{rate:{formatter:e=>`${e}%`}},height:220},W={data:a,xField:"name",yField:"totalScore",label:{position:"top",style:{fill:"#1890ff"},formatter:e=>e&&void 0!==e.totalScore&&null!==e.totalScore?`${e.totalScore.toFixed(1)}`:"0.0"},meta:{name:{alias:"\u5458\u5de5\u59d3\u540d"},totalScore:{alias:"\u5f97\u5206\u603b\u548c"}},height:220};return(0,R.jsx)("div",{className:"team-internal-report",style:{maxWidth:"1200px",margin:"0 auto"},children:(0,R.jsx)(h.A,{title:"\u73ed\u7ec4\u5185\u90e8\u62a5\u8868\u7edf\u8ba1",size:"small",bodyStyle:{padding:"12px"},extra:(0,R.jsxs)(u.A,{size:"small",children:[(0,R.jsx)(I,{value:b,onChange:C,allowClear:!1,ranges:z,size:"small"}),(0,R.jsx)(g.A,{icon:(0,R.jsx)(v.A,{}),onClick:H,loading:e,size:"small",children:"\u5237\u65b0"})]}),children:e?(0,R.jsx)(i.A,{tip:"\u52a0\u8f7d\u4e2d...",size:"large",style:{marginTop:60,display:"flex",justifyContent:"center"}}):n&&!F?(0,R.jsx)(c.A,{message:n,type:"error",style:{marginTop:15}}):a&&0!==a.length?(0,R.jsxs)(m.A,{gutter:[12,12],children:[(F||n)&&(0,R.jsx)(p.A,{span:24,children:(0,R.jsx)(c.A,{message:F?"\u5f53\u524d\u663e\u793a\u7684\u662f\u6a21\u62df\u6570\u636e":"\u6570\u636e\u52a0\u8f7d\u51fa\u73b0\u95ee\u9898",description:(0,R.jsxs)("div",{children:[(0,R.jsx)("p",{style:{margin:"8px 0"},children:n||"\u65e0\u6cd5\u4ece\u670d\u52a1\u5668\u83b7\u53d6\u771f\u5b9e\u6570\u636e\uff0c\u5f53\u524d\u663e\u793a\u7684\u662f\u6a21\u62df\u6570\u636e\u3002"}),(0,R.jsxs)(u.A,{children:[(0,R.jsx)(g.A,{type:"primary",size:"small",icon:(0,R.jsx)(v.A,{}),onClick:H,loading:e,children:"\u91cd\u65b0\u52a0\u8f7d\u6570\u636e"}),(0,R.jsx)(g.A,{type:"link",size:"small",onClick:B,loading:E.checking,children:"\u68c0\u67e5API\u72b6\u6001"})]})]}),type:"warning",showIcon:!0,style:{marginBottom:12}})}),(0,R.jsx)(p.A,{xs:24,lg:8,children:(0,R.jsx)(h.A,{title:(0,R.jsxs)(u.A,{children:[(0,R.jsx)("span",{children:"\u5efa\u8bae\u63d0\u4ea4\u6570\u91cf"}),!0===E.available&&(0,R.jsxs)(D,{type:"success",children:[(0,R.jsx)(f.A,{})," API\u53ef\u7528"]}),!1===E.available&&(0,R.jsxs)(D,{type:"danger",children:[(0,R.jsx)(w.A,{})," API\u4e0d\u53ef\u7528"]})]}),size:"small",bordered:!1,bodyStyle:{padding:"8px"},headStyle:{padding:"8px 12px"},extra:(0,R.jsx)(g.A,{icon:(0,R.jsx)(v.A,{}),onClick:H,loading:e,size:"small",children:"\u5237\u65b0"}),children:(0,R.jsx)(x.A,{...N})})}),(0,R.jsx)(p.A,{xs:24,lg:8,children:(0,R.jsx)(h.A,{title:"\u901a\u8fc7\u7387\u548c\u5b9e\u65bd\u5b8c\u6210\u7387\u5bf9\u6bd4",size:"small",bordered:!1,bodyStyle:{padding:"8px"},headStyle:{padding:"8px 12px"},children:(0,R.jsx)(A.A,{...U})})}),(0,R.jsx)(p.A,{xs:24,lg:8,children:(0,R.jsx)(h.A,{title:"\u5458\u5de5\u5f97\u5206\u7edf\u8ba1",size:"small",bordered:!1,bodyStyle:{padding:"8px"},headStyle:{padding:"8px 12px"},children:(0,R.jsx)(x.A,{...W})})}),(0,R.jsx)(p.A,{span:24,children:(0,R.jsx)(h.A,{title:"\u8be6\u7ec6\u6570\u636e",size:"small",bordered:!1,bodyStyle:{padding:"8px"},headStyle:{padding:"8px 12px"},children:(0,R.jsx)(y.A,{columns:K,dataSource:a,rowKey:"name",loading:e,size:"small",pagination:!1})})})]}):(0,R.jsx)(d.A,{description:"\u6682\u65e0\u6570\u636e",style:{marginTop:30}})})})}}}]);
//# sourceMappingURL=118.ab4bfbb0.chunk.js.map