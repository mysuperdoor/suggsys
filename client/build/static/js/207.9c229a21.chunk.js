(self.webpackChunkclient=self.webpackChunkclient||[]).push([[207],{17640:()=>{},23237:()=>{},31815:()=>{},66671:()=>{},74089:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>Be});var r=s(65043),i=s(84892),n=s(33307),o=s(33946),l=s(94406),d=s(50289),a=s(48193),c=s(5397),x=s(26655),p=s(44394),h=s(89421),m=s(28440),u=s(47419),g=s(11645),y=s(64435),f=s(76466),j=s(8387),A=s(95862),v=s(73216),b=s(39470),w=s(92252),S=s(67407),R=s(46237),I=s(59654),T=s(61966),k=s(36091),C=s(73889),L=s(26510),B=s(78816),E=s(19119),F=s(82437),P=s(81015),W=(s(86178),s(35696)),D=s(72809),O=s(66730),M=s(10934),U=s(68600),z=s(55574),$=s(75958),_=(s(66601),s(71975),s(47633));const N=()=>{{const e="https://diaodu.eu.org/api".replace(/\/api$/,"");return console.log("\u4ece\u73af\u5883\u53d8\u91cf\u83b7\u53d6API\u57fa\u7840URL:",e),e}},q=e=>{if(e&&e.startsWith("http"))return e;const t=e&&!e.startsWith("/")?`/${e}`:e,s=N();return t?`${s}${t}`:""};var G=s(70579);const H=e=>{let{fileUrl:t}=e;const[s,i]=(0,r.useState)(""),[n,o]=(0,r.useState)(!0),[l,d]=(0,r.useState)(null);return(0,r.useEffect)((()=>{if(t){o(!0),d(null);const e=q(t);console.log("Word\u9884\u89c8 - \u539f\u59cbURL:",t),console.log("Word\u9884\u89c8 - \u5b8c\u6574URL:",e);const s=localStorage.getItem("token");fetch(e,{headers:s?{Authorization:`Bearer ${s}`}:{}}).then((e=>{if(!e.ok)throw console.error("Word\u9884\u89c8 - \u670d\u52a1\u5668\u54cd\u5e94\u9519\u8bef:",e.status,e.statusText),new Error(`\u670d\u52a1\u5668\u9519\u8bef: ${e.status}`);return console.log("Word\u9884\u89c8 - \u54cd\u5e94\u5934:",{contentType:e.headers.get("content-type"),contentLength:e.headers.get("content-length"),contentDisposition:e.headers.get("content-disposition")}),e.arrayBuffer()})).then((e=>{if(!e||0===e.byteLength)throw new Error("\u6536\u5230\u7a7a\u7684\u6587\u4ef6\u6570\u636e");return console.log("Word\u9884\u89c8 - \u6210\u529f\u83b7\u53d6\u6587\u4ef6\u6570\u636e\uff0c\u5927\u5c0f:",e.byteLength,"\u5b57\u8282"),console.log("Word\u9884\u89c8 - \u5f00\u59cb\u8f6c\u6362Word\u6587\u6863"),_.convertToHtml({arrayBuffer:e}).then((e=>{console.log("Word\u9884\u89c8 - \u8f6c\u6362\u6210\u529f"),e.messages&&e.messages.length>0&&console.log("Word\u9884\u89c8 - \u8f6c\u6362\u6d88\u606f:",e.messages),i(e.value),o(!1)})).catch((e=>{console.error("Word\u6587\u6863\u8f6c\u6362\u5931\u8d25:",e),d("\u6587\u6863\u8f6c\u6362\u5931\u8d25: "+e.message),o(!1)}))})).catch((e=>{console.error("\u83b7\u53d6Word\u6587\u6863\u5931\u8d25:",e),d(`\u83b7\u53d6\u6587\u6863\u5931\u8d25: ${e.message}`),o(!1)}))}}),[t]),n?(0,G.jsx)(c.A,{size:"large",tip:"\u6b63\u5728\u5904\u7406Word\u6587\u6863..."}):l?(0,G.jsx)("div",{style:{textAlign:"center",color:"red",padding:"20px"},children:l}):(0,G.jsx)("div",{className:"word-preview-container",dangerouslySetInnerHTML:{__html:s},style:{padding:"20px",backgroundColor:"white",border:"1px solid #f0f0f0",maxHeight:"calc(100vh - 260px)",overflowY:"auto",textAlign:"left"}})},{Text:V}=i.A,Y=e=>{let{fileUrl:t}=e;const[s,i]=(0,r.useState)(!0),[n,o]=(0,r.useState)(""),[l,d]=(0,r.useState)(null);return(0,r.useEffect)((()=>{t&&(async()=>{try{const e=q(t);console.log("TextPreview - \u539f\u59cbURL:",t),console.log("TextPreview - \u5b8c\u6574URL:",e),i(!0);const s=localStorage.getItem("token"),r={headers:s?{Authorization:`Bearer ${s}`}:{}};console.log("TextPreview - \u53d1\u9001\u8bf7\u6c42\uff0c\u8bf7\u6c42\u9009\u9879:",r);const n=await fetch(e,r);if(!n.ok)throw console.error("TextPreview - \u54cd\u5e94\u4e0d\u6210\u529f:",n.status,n.statusText),new Error(`\u65e0\u6cd5\u83b7\u53d6\u6587\u672c\u5185\u5bb9\uff0c\u670d\u52a1\u5668\u8fd4\u56de: ${n.status}`);console.log("TextPreview - \u54cd\u5e94\u5934:",{contentType:n.headers.get("content-type"),contentLength:n.headers.get("content-length"),contentDisposition:n.headers.get("content-disposition")});const l=await n.text();console.log("TextPreview - \u6210\u529f\u83b7\u53d6\u6587\u672c\u5185\u5bb9\uff0c\u957f\u5ea6:",(null===l||void 0===l?void 0:l.length)||0),o(l)}catch(e){console.error("TextPreview - \u6587\u672c\u6587\u4ef6\u52a0\u8f7d\u5931\u8d25:",e),d(e.message||"\u52a0\u8f7d\u6587\u672c\u5185\u5bb9\u65f6\u53d1\u751f\u9519\u8bef")}finally{i(!1)}})()}),[t]),s?(0,G.jsx)("div",{style:{width:"100%",height:"300px",display:"flex",justifyContent:"center",alignItems:"center"},children:(0,G.jsx)(c.A,{tip:"\u6b63\u5728\u52a0\u8f7d\u6587\u672c\u5185\u5bb9..."})}):l?(0,G.jsx)(p.A,{message:"\u52a0\u8f7d\u6587\u672c\u5931\u8d25",description:l,type:"error",showIcon:!0}):(0,G.jsx)(x.A,{style:{width:"100%",height:"calc(100vh - 260px)",maxHeight:"70vh",overflowY:"auto",textAlign:"left"},bodyStyle:{padding:"16px",textAlign:"left"},children:(0,G.jsx)("pre",{style:{whiteSpace:"pre-wrap",wordBreak:"break-word",fontFamily:"monospace",fontSize:"14px",margin:0,padding:0,textAlign:"left",display:"block"},children:n})})};D.A.GlobalWorkerOptions.workerSrc=new URL(s(61886),s.b).toString();const J=e=>{let{visible:t,onClose:s,filename:i}=e;const[n,l]=(0,r.useState)(!0),[d,x]=(0,r.useState)(null),[p,m]=(0,r.useState)(null),[u,g]=(0,r.useState)(null),[f,j]=(0,r.useState)(1),A=()=>j((e=>Math.min(e+.2,3))),v=()=>j((e=>Math.max(e-.2,.5))),b=()=>j(1);(0,r.useEffect)((()=>{if(t&&i){l(!0),x(null),m(null),g(null);const e=q(`/download/preview/${encodeURIComponent(i)}`);console.log("FilePreview - \u9884\u89c8\u6587\u4ef6:",i),console.log("FilePreview - \u5b8c\u6574\u9884\u89c8URL:",e);const t=localStorage.getItem("token");fetch(e,{headers:t?{Authorization:`Bearer ${t}`}:{}}).then((t=>{if(!t.ok)throw new Error(`\u670d\u52a1\u5668\u9519\u8bef: ${t.status} ${t.statusText}`);const s=t.headers.get("content-type");return x(s),console.log("FilePreview - \u6587\u4ef6\u7c7b\u578b:",s),s&&s.includes("application/json")?t.json():(m(e),null)})).then((e=>{e&&e.message&&(a.Ay.info(e.message),m(null))})).catch((e=>{console.error("\u9884\u89c8\u6587\u4ef6\u51fa\u9519:",e),a.Ay.error(`\u9884\u89c8\u6587\u4ef6\u83b7\u53d6\u5931\u8d25: ${e.message}`),m(null)})).finally((()=>{l(!1)}))}else t||(l(!0),x(null),m(null),g(null))}),[t,i]);return(0,G.jsx)(o.A,{title:i?`\u6587\u4ef6\u9884\u89c8: ${i}`:"\u6587\u4ef6\u9884\u89c8",open:t,onCancel:s,width:"80vw",style:{top:20},footer:null,destroyOnClose:!0,children:(0,G.jsx)("div",{style:{textAlign:"center",minHeight:"300px",padding:"10px"},children:(()=>{if(n)return(0,G.jsx)(c.A,{size:"large",tip:"\u52a0\u8f7d\u4e2d..."});if(!p&&"application/pdf"===d)return(0,G.jsx)("div",{children:"PDF\u94fe\u63a5\u65e0\u6548\u6216\u52a0\u8f7d\u5931\u8d25\u3002"});if(!d||!p)return(0,G.jsx)("div",{children:"\u65e0\u6cd5\u9884\u89c8\u6b64\u6587\u4ef6\u6216\u6587\u4ef6\u52a0\u8f7d\u5931\u8d25\u3002"});if(d.startsWith("image/"))return(0,G.jsx)("img",{src:p,alt:i||"preview",style:{maxWidth:"100%",maxHeight:"600px"}});if("application/vnd.openxmlformats-officedocument.wordprocessingml.document"===d||"application/msword"===d)return(0,G.jsx)(H,{fileUrl:p});if("application/pdf"===d){const e=Math.min(600,.8*window.innerWidth),t=localStorage.getItem("token");return(0,G.jsxs)(G.Fragment,{children:[(0,G.jsx)("div",{style:{position:"sticky",top:0,backgroundColor:"white",padding:"10px",zIndex:1,borderBottom:"1px solid #f0f0f0",marginBottom:"10px",width:"100%",display:"flex",justifyContent:"center"},children:(0,G.jsxs)(y.A,{children:[(0,G.jsx)(W.A,{title:"\u7f29\u5c0f",children:(0,G.jsx)(h.A,{icon:(0,G.jsx)(U.A,{}),onClick:v,disabled:f<=.5})}),(0,G.jsx)(W.A,{title:"\u91cd\u7f6e\u7f29\u653e",children:(0,G.jsxs)(h.A,{icon:(0,G.jsx)(z.A,{}),onClick:b,disabled:1===f,children:[Math.round(100*f),"%"]})}),(0,G.jsx)(W.A,{title:"\u653e\u5927",children:(0,G.jsx)(h.A,{icon:(0,G.jsx)($.A,{}),onClick:A,disabled:f>=3})})]})}),(0,G.jsx)("div",{style:{width:"100%",height:"calc(100vh - 260px)",maxHeight:"70vh",overflowY:"auto",display:"flex",flexDirection:"column",alignItems:"center"},children:(0,G.jsx)(O.A,{file:{url:p,httpHeaders:t?{Authorization:`Bearer ${t}`}:void 0,withCredentials:!!t},onLoadSuccess:e=>{let{numPages:t}=e;console.log("PDF\u52a0\u8f7d\u6210\u529f\uff0c\u9875\u6570:",t),g(t)},onLoadError:e=>{console.error("PDF\u52a0\u8f7d\u9519\u8bef:",e),(e=>{console.error("React-PDF Document Load Error:",e),a.Ay.error(`PDF\u52a0\u8f7d\u5931\u8d25: ${e.message}`)})(e)},loading:(0,G.jsx)(c.A,{size:"large",tip:"\u6b63\u5728\u52a0\u8f7dPDF..."}),options:{cMapUrl:"https://cdn.jsdelivr.net/npm/pdfjs-dist@3.11.174/cmaps/",cMapPacked:!0,standardFontDataUrl:"https://cdn.jsdelivr.net/npm/pdfjs-dist@3.11.174/standard_fonts/"},children:u&&Array.from(new Array(u),((t,s)=>(0,G.jsx)(M.A,{pageNumber:s+1,width:e*f,renderTextLayer:!1,renderAnnotationLayer:!1,style:{marginBottom:"10px",boxShadow:"0 2px 5px rgba(0,0,0,0.1)"},error:e=>(console.error("Page\u6e32\u67d3\u9519\u8bef:",e),(0,G.jsxs)("div",{children:["\u9875\u9762\u6e32\u67d3\u9519\u8bef: ",e.message]}))},`page_${s+1}`)))})})]})}return d.startsWith("text/")?(0,G.jsx)(Y,{fileUrl:p}):(0,G.jsx)("div",{children:"\u6b64\u6587\u4ef6\u7c7b\u578b\u6682\u4e0d\u652f\u6301\u76f4\u63a5\u9884\u89c8\u3002"})})()})})};var Z=s(263),K=s(45565),Q=s(30119),X=s(53722),ee=s(38818);const te=e=>{var t;let{suggestion:s,isMobile:r}=e;const i={container:{padding:"12px 16px",background:"linear-gradient(to right, #f8f8f8, #ffffff)",borderRadius:"8px",marginBottom:"24px",border:"1px solid #eaeaea",boxShadow:"0 2px 5px rgba(0, 0, 0, 0.03)"},tagStyle:{padding:"2px 8px",borderRadius:"15px",margin:0,fontWeight:500}};return(0,G.jsx)("div",{style:i.container,children:(0,G.jsxs)(Z.A,{column:r?1:4,size:r?"small":"default",colon:!1,labelStyle:{width:r?"60px":"70px",color:"#666",fontWeight:"500"},contentStyle:{color:"#333"},children:[(0,G.jsx)(Z.A.Item,{label:(0,G.jsxs)("span",{style:{display:"flex",alignItems:"center"},children:[(0,G.jsx)(K.A,{style:{color:"#1890ff",marginRight:"4px"}}),"\u7c7b\u578b"]}),children:(0,G.jsx)(j.A,{color:E.TYPE_COLORS[s.type]||"default",style:i.tagStyle,children:E.SUGGESTION_TYPES[s.type]||s.type})}),(0,G.jsx)(Z.A.Item,{label:(0,G.jsxs)("span",{style:{display:"flex",alignItems:"center"},children:[(0,G.jsx)(Q.A,{style:{color:"#722ed1",marginRight:"4px"}}),"\u65f6\u95f4"]}),children:(0,G.jsx)(j.A,{color:"purple",style:i.tagStyle,children:(e=>{if(!e)return"\u672a\u77e5";const t=new Date(e);return r?`${t.toLocaleDateString()} ${t.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})}`:t.toLocaleString()})(s.createdAt)})}),(0,G.jsx)(Z.A.Item,{label:(0,G.jsxs)("span",{style:{display:"flex",alignItems:"center"},children:[(0,G.jsx)(X.A,{style:{color:"#1890ff",marginRight:"4px"}}),"\u63d0\u4ea4\u4eba"]}),children:(0,G.jsx)(j.A,{color:"blue",style:i.tagStyle,children:(null===(t=s.submitter)||void 0===t?void 0:t.name)||"\u672a\u77e5"})}),(0,G.jsx)(Z.A.Item,{label:(0,G.jsxs)("span",{style:{display:"flex",alignItems:"center"},children:[(0,G.jsx)(ee.A,{style:{color:"#52c41a",marginRight:"4px"}}),"\u73ed\u7ec4"]}),children:(0,G.jsx)(j.A,{color:"green",style:i.tagStyle,children:s.team||"\u672a\u6307\u5b9a"})})]})})};var se=s(39998);const re=e=>{let{title:t,content:s,isMobile:r}=e;const i={dividerStyle:{margin:r?"16px 0":"20px 0",color:"#1890ff",fontSize:r?"16px":"18px"},contentBlockStyle:{whiteSpace:"pre-wrap",padding:"20px",borderRadius:"12px",background:"#fafafa",border:"1px solid #e8e8e8",boxShadow:"0 2px 6px rgba(0, 0, 0, 0.03)",marginBottom:"24px",fontSize:"15px",lineHeight:"1.8",position:"relative",overflow:"hidden"},highlightBar:{position:"absolute",left:0,top:0,width:"4px",height:"100%",background:"\u5efa\u8bae\u5185\u5bb9"===t?"#1890ff":"#52c41a",borderRadius:"4px 0 0 4px"}};return(0,G.jsxs)(G.Fragment,{children:[(0,G.jsx)(se.A,{orientation:"left",style:i.dividerStyle,children:(0,G.jsx)("strong",{children:t})}),(0,G.jsxs)("div",{style:i.contentBlockStyle,children:[(0,G.jsx)("div",{style:i.highlightBar}),(0,G.jsx)("div",{style:{marginLeft:"10px"},children:s})]})]})};var ie=s(75639),ne=s(43688),oe=s(19741),le=s(67630),de=s(62533),ae=s(12959),ce=s(89330),xe=s(76191);const{Text:pe}=i.A,he=e=>{let{attachments:t,handleDownloadAttachment:s,handlePreviewFile:r,isMobile:i,fixEncodingIssues:n}=e;const o={dividerStyle:{margin:i?"16px 0":"20px 0",color:"#1890ff",fontSize:i?"16px":"18px"},cardStyle:{borderRadius:"12px",marginBottom:"16px",boxShadow:"0 1px 4px rgba(0, 0, 0, 0.05)"},listItemStyle:{padding:i?"8px 0":"12px 0",transition:"all 0.3s ease",":hover":{background:"#f0f5ff"}},buttonStyle:(e,t)=>({borderRadius:"16px",boxShadow:"0 2px 4px rgba(0, 0, 0, 0.1)",border:0,transition:"all 0.3s",padding:t?"0 6px":"0 12px",height:"28px",minWidth:t?"28px":void 0,display:"inline-flex",alignItems:"center",justifyContent:"center"})},l=e=>{if(!e)return(0,G.jsx)(k.A,{});const t=e.split(".").pop().toLowerCase();return["jpg","jpeg","png","gif","bmp","webp"].includes(t)?(0,G.jsx)(oe.A,{style:{color:"#13c2c2"}}):["pdf"].includes(t)?(0,G.jsx)(le.A,{style:{color:"#f5222d"}}):["doc","docx"].includes(t)?(0,G.jsx)(de.A,{style:{color:"#1890ff"}}):["xls","xlsx","csv"].includes(t)?(0,G.jsx)(ae.A,{style:{color:"#52c41a"}}):(0,G.jsx)(k.A,{style:{color:"#fa8c16"}})},d=e=>{if(!e)return"\u672a\u77e5\u65f6\u95f4";const t=new Date(e);return i?t.toLocaleDateString():t.toLocaleString()};return(0,G.jsxs)(G.Fragment,{children:[(0,G.jsxs)(se.A,{orientation:"left",style:o.dividerStyle,children:[(0,G.jsx)(ce.A,{})," ",(0,G.jsx)("strong",{children:"\u9644\u4ef6"})]}),(0,G.jsx)(x.A,{type:"inner",style:o.cardStyle,bodyStyle:{padding:i?"12px":"16px"},children:(0,G.jsx)(ie.Ay,{itemLayout:i?"vertical":"horizontal",dataSource:t,renderItem:e=>(0,G.jsx)(ie.Ay.Item,{style:o.listItemStyle,actions:[(0,G.jsx)(h.A,{type:"primary",ghost:!0,size:"small",icon:(0,G.jsx)(ce.A,{}),onClick:()=>s(e),style:o.buttonStyle("download",i),children:i?null:"\u4e0b\u8f7d"}),(0,G.jsx)(h.A,{type:"default",size:"small",icon:(0,G.jsx)(xe.A,{}),onClick:()=>r(e),style:{...o.buttonStyle("preview",i),marginLeft:"8px"},children:i?null:"\u9884\u89c8"})],children:(0,G.jsx)(ie.Ay.Item.Meta,{avatar:(0,G.jsx)(ne.A,{shape:"square",icon:l(e.originalname),size:i?"default":"large",style:{backgroundColor:"#f5f5f5"}}),title:(0,G.jsx)(pe,{style:{fontSize:i?"14px":"15px",fontWeight:500},ellipsis:{tooltip:e.originalname?n(e.originalname):"\u672a\u77e5\u6587\u4ef6\u540d"},children:e.originalname?n(e.originalname):"\u672a\u77e5\u6587\u4ef6\u540d"}),description:`\u4e0a\u4f20\u4e8e ${d(e.uploadedAt)}`})})})})]})};var me=s(15832);const{Text:ue}=i.A,ge=e=>{let{currentStatus:t,implementation:s,scoring:r,isMobile:i}=e;const n={card:{borderRadius:"10px",marginBottom:"16px"},tagStyle:{padding:"3px 10px",borderRadius:"12px",marginLeft:"8px",fontSize:"14px",fontWeight:"500"},badgeStyle:e=>{const t="APPROVED"===e,s="REJECTED"===e;return{display:"block",padding:"4px 8px 4px 4px",background:t?"#f6ffed":s?"#fff2f0":"#e6f7ff",border:"1px solid "+(t?"#b7eb8f":s?"#ffccc7":"#91d5ff"),borderRadius:"16px",marginBottom:"16px"}},badgeDot:e=>({display:"inline-block",width:"8px",height:"8px",borderRadius:"50%",background:"APPROVED"===e?"#52c41a":"REJECTED"===e?"#f5222d":"#1890ff",marginRight:"8px"})};return(0,G.jsx)(x.A,{title:(0,G.jsxs)("div",{style:{display:"flex",alignItems:"center"},children:[(0,G.jsx)("span",{style:{marginRight:"8px"},children:"\u72b6\u6001\u4fe1\u606f"}),(0,G.jsx)(me.A,{status:"success"===E.STATUS_COLORS[t]?"success":"error"===E.STATUS_COLORS[t]?"error":"warning"===E.STATUS_COLORS[t]?"warning":"processing"})]}),type:"inner",style:n.card,bodyStyle:{padding:i?"16px":"20px"},children:(0,G.jsx)(y.A,{direction:"vertical",style:{width:"100%"},children:(0,G.jsxs)("div",{children:[(0,G.jsxs)("div",{style:n.badgeStyle(t),children:[(0,G.jsx)("span",{style:n.badgeDot(t)}),(0,G.jsx)(ue,{strong:!0,children:"\u5f53\u524d\u72b6\u6001: "}),(0,G.jsx)(ue,{style:{fontWeight:"500"},children:E.SUGGESTION_STATUS[t]||t})]}),s&&(0,G.jsxs)("div",{style:n.badgeStyle(s.status),children:[(0,G.jsx)("span",{style:n.badgeDot(s.status)}),(0,G.jsx)(ue,{strong:!0,children:"\u5b9e\u65bd\u72b6\u6001: "}),(0,G.jsx)(ue,{style:{fontWeight:"500"},children:(0,F.Aw)(s.status||"NOT_STARTED","implementation")})]}),r&&void 0!==r.score&&(0,G.jsxs)("div",{style:{marginTop:"16px"},children:[(0,G.jsx)(ue,{strong:!0,children:"\u5efa\u8bae\u8bc4\u5206: "}),(0,G.jsx)(j.A,{color:"gold",style:n.tagStyle,children:"number"===typeof r.score?r.score.toFixed(1):"-"})]})]})})})};var ye=s(89967),fe=s(81210);const{Text:je,Paragraph:Ae}=i.A,ve=e=>{var t,s;let{review:r,type:i,isMobile:n}=e;const o="APPROVED"===r.result,l={card:{borderRadius:"10px",marginBottom:"16px",borderLeft:"3px solid "+(o?"#52c41a":"#f5222d")},header:{display:"flex",alignItems:"center",marginBottom:"16px"},icon:{fontSize:"18px",marginRight:"8px",color:o?"#52c41a":"#f5222d"},title:{margin:0,fontWeight:"bold"},resultTag:{borderRadius:"12px",padding:"2px 10px",fontWeight:"bold",marginLeft:"8px"},infoItem:{display:"flex",alignItems:"center",marginBottom:"8px"},infoIcon:{marginRight:"8px",color:"#1890ff"},infoLabel:{fontWeight:"bold",marginRight:"8px"},commentBox:{padding:"12px 16px",background:"#f9f9f9",borderRadius:"8px",marginTop:"12px",border:"1px solid #e8e8e8"}},d=r.reviewedAt?new Date(r.reviewedAt).toLocaleString():"\u672a\u77e5";return(0,G.jsxs)(x.A,{type:"inner",style:l.card,bodyStyle:{padding:n?"16px":"20px"},children:[(0,G.jsxs)("div",{style:l.header,children:[o?(0,G.jsx)(R.A,{style:l.icon}):(0,G.jsx)(ye.A,{style:l.icon}),(0,G.jsx)("h3",{style:l.title,children:"first"===i?"\u4e00\u7ea7\u5ba1\u6838":"\u4e8c\u7ea7\u5ba1\u6838"}),(0,G.jsx)(j.A,{color:o?"success":"error",style:l.resultTag,children:o?"\u901a\u8fc7":"\u62d2\u7edd"})]}),(0,G.jsxs)(u.A,{gutter:[16,16],children:[(0,G.jsx)(g.A,{xs:24,sm:12,children:(0,G.jsxs)("div",{style:l.infoItem,children:[(0,G.jsx)(X.A,{style:l.infoIcon}),(0,G.jsx)("span",{style:l.infoLabel,children:"\u5ba1\u6838\u4eba:"}),(0,G.jsx)(ne.A,{size:"small",style:{marginRight:"8px",backgroundColor:"#1890ff"},children:null!==(t=r.reviewer)&&void 0!==t&&t.name?r.reviewer.name.charAt(0):"?"}),(0,G.jsx)(je,{children:(null===(s=r.reviewer)||void 0===s?void 0:s.name)||"\u672a\u77e5"})]})}),(0,G.jsx)(g.A,{xs:24,sm:12,children:(0,G.jsxs)("div",{style:l.infoItem,children:[(0,G.jsx)(fe.A,{style:l.infoIcon}),(0,G.jsx)("span",{style:l.infoLabel,children:"\u5ba1\u6838\u65f6\u95f4:"}),(0,G.jsx)(je,{children:d})]})}),(0,G.jsxs)(g.A,{span:24,children:[(0,G.jsxs)("div",{style:l.infoItem,children:[(0,G.jsx)(w.A,{style:l.infoIcon}),(0,G.jsx)("span",{style:l.infoLabel,children:"\u5ba1\u6838\u610f\u89c1:"})]}),(0,G.jsx)("div",{style:l.commentBox,children:r.comments?(0,G.jsx)(Ae,{style:{margin:0},children:r.comments}):(0,G.jsx)(je,{type:"secondary",children:"\u65e0\u5ba1\u6838\u610f\u89c1"})})]})]})]})},{Text:be}=i.A,we=e=>{var t,s,r;let{scoring:i,isMobile:n}=e;if(!i||void 0===i.score)return null;const o={card:{borderRadius:"10px",marginBottom:"16px",borderLeft:"3px solid #faad14"},header:{display:"flex",alignItems:"center",marginBottom:"16px"},icon:{fontSize:"18px",marginRight:"8px",color:"#faad14"},title:{margin:0,fontWeight:"bold"},scoreTag:{borderRadius:"12px",padding:"2px 10px",fontWeight:"bold",fontSize:"14px",marginLeft:"8px"},infoItem:{display:"flex",alignItems:"center",marginBottom:"12px"},infoIcon:{marginRight:"8px",color:"#1890ff"},infoLabel:{fontWeight:"bold",marginRight:"8px"},timelineItem:{padding:"8px 0"},historyScore:{fontWeight:"bold",fontSize:"16px",color:"#faad14",marginLeft:"8px"}},l=e=>e?new Date(e).toLocaleString():"\u672a\u77e5";return(0,G.jsxs)(x.A,{type:"inner",style:o.card,bodyStyle:{padding:n?"16px":"20px"},children:[(0,G.jsxs)("div",{style:o.header,children:[(0,G.jsx)(I.A,{style:o.icon}),(0,G.jsx)("h3",{style:o.title,children:"\u5efa\u8bae\u8bc4\u5206"}),(0,G.jsx)(j.A,{color:"gold",style:o.scoreTag,children:"number"===typeof i.score?i.score.toFixed(1):"-"})]}),(0,G.jsxs)(u.A,{gutter:[16,16],children:[(0,G.jsx)(g.A,{xs:24,sm:12,children:(0,G.jsxs)("div",{style:o.infoItem,children:[(0,G.jsx)(X.A,{style:o.infoIcon}),(0,G.jsx)("span",{style:o.infoLabel,children:"\u8bc4\u5206\u4eba:"}),(0,G.jsx)(ne.A,{size:"small",style:{marginRight:"8px",backgroundColor:"#faad14"},children:null!==(t=i.scorer)&&void 0!==t&&t.name?i.scorer.name.charAt(0):"?"}),(0,G.jsx)(be,{children:(null===(s=i.scorer)||void 0===s?void 0:s.name)||"\u672a\u77e5"})]})}),(0,G.jsx)(g.A,{xs:24,sm:12,children:(0,G.jsxs)("div",{style:o.infoItem,children:[(0,G.jsx)(ee.A,{style:o.infoIcon}),(0,G.jsx)("span",{style:o.infoLabel,children:"\u89d2\u8272:"}),(0,G.jsx)(j.A,{color:"blue",children:(null===(r=i.scorer)||void 0===r?void 0:r.role)||i.scorerRole||"\u672a\u77e5\u89d2\u8272"})]})}),(0,G.jsx)(g.A,{xs:24,children:(0,G.jsxs)("div",{style:o.infoItem,children:[(0,G.jsx)(fe.A,{style:o.infoIcon}),(0,G.jsx)("span",{style:o.infoLabel,children:"\u8bc4\u5206\u65f6\u95f4:"}),(0,G.jsx)(be,{children:l(i.scoredAt)})]})})]}),i.history&&i.history.length>0&&(0,G.jsxs)(G.Fragment,{children:[(0,G.jsx)("div",{style:{marginTop:"16px",marginBottom:"8px",fontWeight:"bold"},children:"\u8bc4\u5206\u5386\u53f2"}),(0,G.jsx)(f.A,{style:{marginTop:12},children:i.history.map(((e,t)=>{var s,r,i;return(0,G.jsx)(f.A.Item,{color:"gold",dot:(0,G.jsx)(I.A,{style:{fontSize:"16px"}}),children:(0,G.jsxs)("div",{style:o.timelineItem,children:[(0,G.jsxs)("div",{children:[(0,G.jsx)(ne.A,{size:"small",style:{marginRight:"8px",backgroundColor:"#1890ff"},children:null!==(s=e.scorer)&&void 0!==s&&s.name?e.scorer.name.charAt(0):"?"}),(0,G.jsx)(be,{strong:!0,children:(null===(r=e.scorer)||void 0===r?void 0:r.name)||"\u672a\u77e5\u7528\u6237"}),(0,G.jsx)(j.A,{color:"blue",style:{margin:"0 8px"},children:(null===(i=e.scorer)||void 0===i?void 0:i.role)||e.scorerRole||"\u672a\u77e5\u89d2\u8272"})]}),(0,G.jsxs)("div",{style:{marginTop:"4px",marginLeft:"28px",color:"#888"},children:[l(e.scoredAt),"\u8bc4\u5206\u4e3a ",(0,G.jsx)("span",{style:o.historyScore,children:"number"===typeof e.score?e.score.toFixed(1):"?"})]})]})},t)}))})]})]})},{Title:Se,Text:Re,Paragraph:Ie}=i.A,{TextArea:Te}=n.A,{confirm:ke}=o.A,{Option:Ce}=l.A,Le=e=>{try{return/[\xe8\xe9\xea\xeb\xe0\xe1\xe2\xe3\xe4\xe5\xe6\xe7\xec\xed\xee\xef\xf2\xf3\xf4\xf5\xf8\xf9\xfa\xfb\xfc]/.test(e)?decodeURIComponent(escape(e)):e}catch(t){return console.error("\u4fee\u590d\u6587\u4ef6\u540d\u7f16\u7801\u9519\u8bef:",t),e}},Be=()=>{var e;const{id:t}=(0,v.g)(),s=(0,v.Zp)(),[i,F]=(0,r.useState)(null),[W,D]=(0,r.useState)(!0),[O,M]=(0,r.useState)(!1),[U,z]=(0,r.useState)(!1),[$,_]=(0,r.useState)(!1),[N,q]=(0,r.useState)(!1),[H,V]=(0,r.useState)(!1),[Y]=d.A.useForm(),[Z]=d.A.useForm(),[K]=d.A.useForm(),[Q]=d.A.useForm(),[X]=d.A.useForm(),[ee,se]=(0,r.useState)(!1),[ie,ne]=(0,r.useState)(null),[oe,le]=(0,r.useState)(!1),[de,ae]=(0,r.useState)(!1),[ce,xe]=(0,r.useState)(null),[pe,me]=(0,r.useState)(window.innerWidth<=768),[ue,ye]=(0,r.useState)(""),[fe,je]=(0,r.useState)(""),[Ae,be]=(0,r.useState)(!1),Ie={mainCard:{borderRadius:"8px",boxShadow:"0 4px 12px rgba(0, 0, 0, 0.05)",overflow:"hidden"},contentCard:{borderRadius:"8px",boxShadow:"0 4px 12px rgba(0, 0, 0, 0.05)",height:"100%"},cardBody:{padding:pe?"16px":"24px"}};(0,r.useEffect)((()=>{const e=()=>{const e=window.innerWidth<=768;e!==pe&&me(e)};let t;const s=()=>{clearTimeout(t),t=setTimeout(e,100)};return window.addEventListener("resize",s),()=>{window.removeEventListener("resize",s),clearTimeout(t)}}),[pe]);const Be=(0,r.useMemo)((()=>"\u503c\u73ed\u4e3b\u4efb"===(null===ie||void 0===ie?void 0:ie.role)),[ie]),Ee=((0,r.useMemo)((()=>"\u5b89\u5168\u79d1\u7ba1\u7406\u4eba\u5458"===(null===ie||void 0===ie?void 0:ie.role)||"\u8fd0\u884c\u79d1\u7ba1\u7406\u4eba\u5458"===(null===ie||void 0===ie?void 0:ie.role)||"\u90e8\u95e8\u7ecf\u7406"===(null===ie||void 0===ie?void 0:ie.role)),[ie]),(0,r.useMemo)((()=>"\u90e8\u95e8\u7ecf\u7406"===(null===ie||void 0===ie?void 0:ie.role)),[ie])),Fe=(0,r.useMemo)((()=>"\u5b89\u5168\u79d1\u7ba1\u7406\u4eba\u5458"===(null===ie||void 0===ie?void 0:ie.role)),[ie]),Pe=(0,r.useMemo)((()=>"\u8fd0\u884c\u79d1\u7ba1\u7406\u4eba\u5458"===(null===ie||void 0===ie?void 0:ie.role)),[ie]),We=(0,r.useMemo)((()=>{var e;return(null===ie||void 0===ie?void 0:ie.team)===(null===i||void 0===i?void 0:i.team)||(null===ie||void 0===ie?void 0:ie.team)===(null===i||void 0===i||null===(e=i.submitter)||void 0===e?void 0:e.team)}),[ie,i]),De=(0,r.useMemo)((()=>i?(0,P.q)(i):""),[i]),Oe=(0,r.useMemo)((()=>"PENDING_FIRST_REVIEW"===De),[De]),Me=(0,r.useMemo)((()=>"PENDING_SECOND_REVIEW"===De),[De]),Ue=(0,r.useMemo)((()=>(Be&&We||Ee)&&Oe),[Be,We,Ee,Oe]),ze=(0,r.useMemo)((()=>"SAFETY"===(null===i||void 0===i?void 0:i.type)||"\u5b89\u5168\u7ba1\u7406"===(null===i||void 0===i?void 0:i.type)),[i]),$e=(0,r.useMemo)((()=>(Fe&&ze||Pe&&!ze||Ee)&&Me),[Fe,ze,Pe,Ee,Me]),_e=(0,r.useMemo)((()=>Ee||"\u5b89\u5168\u79d1\u7ba1\u7406\u4eba\u5458"===(null===ie||void 0===ie?void 0:ie.role)&&ze||"\u8fd0\u884c\u79d1\u7ba1\u7406\u4eba\u5458"===(null===ie||void 0===ie?void 0:ie.role)&&!ze),[ie,Ee,ze]),Ne=(0,r.useMemo)((()=>_e&&"APPROVED"===De),[_e,De]),qe=(0,r.useCallback)((async()=>{try{D(!0);const e=await L.O.getSuggestionById(t);F(e.data)}catch(e){a.Ay.error("\u83b7\u53d6\u5efa\u8bae\u8be6\u60c5\u5931\u8d25")}finally{D(!1)}}),[t]);(0,r.useEffect)((()=>{(async()=>{try{const e=await B.y.getCurrentUser();if(!e)return a.Ay.error("\u8bf7\u5148\u767b\u5f55\u540e\u518d\u8bbf\u95ee\u6b64\u9875\u9762"),void s("/login");ne(e)}catch(e){a.Ay.error("\u83b7\u53d6\u7528\u6237\u4fe1\u606f\u5931\u8d25"),s("/login")}})()}),[s]),(0,r.useEffect)((()=>{qe()}),[qe]);const Ge=(0,r.useCallback)((async e=>{try{se(!0),await L.O.addComment(t,e.content),a.Ay.success("\u8bc4\u8bba\u6dfb\u52a0\u6210\u529f"),Y.resetFields(),M(!1),qe()}catch(s){a.Ay.error("\u6dfb\u52a0\u8bc4\u8bba\u5931\u8d25")}finally{se(!1)}}),[]),He=(0,r.useCallback)((async e=>{const t=window.location.protocol+"//"+window.location.hostname+(window.location.port?":"+window.location.port:""),s=localStorage.getItem("token"),r=(new Date).getTime(),i=`${t}/download/${e.filename}?originalname=${encodeURIComponent(e.originalname)}&t=${r}`;try{const t=document.createElement("a");t.style.display="none",t.href=i,s?fetch(i,{headers:{Authorization:`Bearer ${s}`}}).then((e=>{if(!e.ok)throw new Error(`\u4e0b\u8f7d\u5931\u8d25: ${e.status} ${e.statusText}`);return e.blob()})).then((s=>{const r=window.URL.createObjectURL(s);t.href=r,t.download=e.originalname,document.body.appendChild(t),t.click(),setTimeout((()=>{document.body.removeChild(t),window.URL.revokeObjectURL(r)}),100)})).catch((e=>{console.error("\u4e0b\u8f7d\u9644\u4ef6\u5931\u8d25:",e),a.Ay.error("\u4e0b\u8f7d\u9644\u4ef6\u5931\u8d25\uff0c\u8bf7\u7a0d\u540e\u91cd\u8bd5")})):(t.href=i,document.body.appendChild(t),t.click(),document.body.removeChild(t)),console.log("\u4e0b\u8f7d\u9644\u4ef6:",{"\u6587\u4ef6\u540d":e.originalname,"\u7f16\u7801\u540e":encodeURIComponent(e.originalname),URL:i})}catch(n){a.Ay.error("\u4e0b\u8f7d\u9644\u4ef6\u5931\u8d25\uff0c\u8bf7\u7a0d\u540e\u91cd\u8bd5")}}),[]),Ve=(0,r.useCallback)((()=>{ke({title:"\u786e\u8ba4\u5220\u9664\u8fd9\u6761\u5efa\u8bae\u5417\uff1f",icon:(0,G.jsx)(b.A,{}),content:"",okText:"\u786e\u8ba4\u5220\u9664",okType:"danger",cancelText:"\u53d6\u6d88",confirmLoading:oe,async onOk(){le(!0);try{const e=await L.O.deleteSuggestion(t);console.log("handleDelete \u6536\u5230 Service Result:",e),e.success?(a.Ay.success("\u5efa\u8bae\u5df2\u6210\u529f\u5220\u9664"),setTimeout((()=>{s("/suggestions/list")}),1e3)):a.Ay.error(e.message||"\u5220\u9664\u5efa\u8bae\u5931\u8d25")}catch(e){a.Ay.error("\u5220\u9664\u5efa\u8bae\u65f6\u53d1\u751f\u9519\u8bef")}finally{le(!1)}},onCancel(){}})}),[t,s,oe]);if(W)return(0,G.jsx)("div",{style:{textAlign:"center",padding:"50px"},children:(0,G.jsx)(c.A,{tip:"\u52a0\u8f7d\u5efa\u8bae\u8be6\u60c5..."})});if(!i)return(0,G.jsxs)(x.A,{children:[(0,G.jsx)(p.A,{message:"\u5efa\u8bae\u4e0d\u5b58\u5728\u6216\u5df2\u88ab\u5220\u9664",description:"\u60a8\u67e5\u627e\u7684\u5efa\u8bae\u53ef\u80fd\u4e0d\u5b58\u5728\u6216\u5df2\u88ab\u5220\u9664\uff0c\u8bf7\u8fd4\u56de\u5217\u8868\u67e5\u770b\u5176\u4ed6\u5efa\u8bae\u3002",type:"error",showIcon:!0}),(0,G.jsx)("div",{style:{marginTop:16,textAlign:"center"},children:(0,G.jsx)(h.A,{type:"primary",onClick:()=>s("/suggestions/list"),children:"\u8fd4\u56de\u5217\u8868"})})]});const Ye=()=>{Z.setFieldsValue({title:i.title,content:i.content,expectedBenefit:i.expectedBenefit,type:i.type}),z(!0)},Je=()=>{const e=[];e.push((0,G.jsx)(h.A,{icon:(0,G.jsx)(w.A,{}),onClick:()=>M(!0),children:"\u6dfb\u52a0\u8bc4\u8bba"},"comment"));const t=Ee||ie&&i&&i.submitter&&ie._id===i.submitter._id&&(!i.secondReview||"APPROVED"!==i.secondReview.result);return ie&&i&&i.submitter&&ie._id===i.submitter._id&&Oe&&e.push((0,G.jsx)(h.A,{icon:(0,G.jsx)(S.A,{}),onClick:Ye,style:{marginLeft:8},children:"\u7f16\u8f91\u5efa\u8bae"},"edit")),Ue&&e.push((0,G.jsx)(h.A,{type:"primary",icon:(0,G.jsx)(R.A,{}),onClick:()=>_(!0),style:{marginLeft:8},children:"\u4e00\u7ea7\u5ba1\u6838"},"firstReview")),$e&&e.push((0,G.jsx)(h.A,{type:"primary",icon:(0,G.jsx)(R.A,{}),onClick:()=>q(!0),style:{marginLeft:8},children:"\u4e8c\u7ea7\u5ba1\u6838"},"secondReview")),Ne&&e.push((0,G.jsx)(h.A,{icon:(0,G.jsx)(I.A,{}),onClick:()=>V(!0),style:{marginLeft:8},children:"\u8bc4\u5206"},"score")),t&&e.push((0,G.jsx)(m.A,{title:"\u786e\u5b9a\u8981\u5220\u9664\u6b64\u5efa\u8bae\u5417\uff1f",description:"\u5220\u9664\u540e\u5c06\u65e0\u6cd5\u6062\u590d\uff0c\u8bf7\u8c28\u614e\u64cd\u4f5c\uff01",icon:(0,G.jsx)(b.A,{style:{color:"red"}}),onConfirm:Ve,okText:"\u786e\u5b9a\u5220\u9664",cancelText:"\u53d6\u6d88",children:(0,G.jsx)(h.A,{danger:!0,icon:(0,G.jsx)(T.A,{}),style:{marginLeft:8},loading:oe,children:"\u5220\u9664\u5efa\u8bae"})},"delete")),e.length>0?e:null};return(0,G.jsxs)("div",{className:"responsive-container",children:[(0,G.jsx)(x.A,{title:pe?(0,G.jsxs)(G.Fragment,{children:[(0,G.jsx)("div",{style:{width:"100%"},children:(0,G.jsx)(Se,{level:4,style:{margin:0,wordBreak:"break-word",whiteSpace:"normal"},children:i.title})}),(0,G.jsx)("div",{style:{marginTop:"8px",width:"100%",display:"flex",flexWrap:"wrap",justifyContent:"flex-start",gap:"8px"},children:Je()})]}):(0,G.jsxs)(u.A,{justify:"space-between",align:"middle",children:[(0,G.jsx)(g.A,{flex:"auto",children:(0,G.jsx)(Se,{level:4,style:{margin:0,wordBreak:"break-word",whiteSpace:"normal"},children:i.title})}),(0,G.jsx)("div",{style:{marginLeft:"auto",display:"flex",flexWrap:"wrap",justifyContent:"flex-end",gap:"8px"},children:Je()})]}),style:Ie.mainCard,bodyStyle:Ie.cardBody,children:(0,G.jsxs)(u.A,{gutter:[pe?12:24,pe?16:24],style:{marginBottom:"20px"},children:[(0,G.jsx)(g.A,{xs:24,sm:24,md:16,children:(0,G.jsxs)(x.A,{title:(0,G.jsxs)(G.Fragment,{children:[(0,G.jsx)(k.A,{style:{marginRight:"8px"}}),"\u5efa\u8bae\u8be6\u60c5"]}),style:Ie.contentCard,bodyStyle:Ie.cardBody,children:[(0,G.jsx)(te,{suggestion:i,isMobile:pe}),(0,G.jsx)(re,{title:"\u5efa\u8bae\u5185\u5bb9",content:i.content,isMobile:pe}),(0,G.jsx)(re,{title:"\u9884\u671f\u6548\u76ca",content:i.expectedBenefit,isMobile:pe}),i.attachments&&i.attachments.length>0&&(0,G.jsx)(he,{attachments:i.attachments,handleDownloadAttachment:He,handlePreviewFile:e=>{xe(e),ae(!0)},isMobile:pe,fixEncodingIssues:Le})]})}),(0,G.jsx)(g.A,{xs:24,sm:24,md:8,children:(0,G.jsx)(x.A,{title:"\u8ddf\u8fdb\u4fe1\u606f",style:Ie.contentCard,bodyStyle:{padding:pe?"12px":"16px"},children:(0,G.jsxs)(y.A,{direction:"vertical",style:{width:"100%"},size:pe?12:16,children:[(0,G.jsx)(ge,{currentStatus:De,implementation:i.implementation,scoring:i.scoring,isMobile:pe}),i.firstReview&&(0,G.jsx)(ve,{review:i.firstReview,type:"first",isMobile:pe}),i.secondReview&&(0,G.jsx)(ve,{review:i.secondReview,type:"second",isMobile:pe}),i.scoring&&void 0!==i.scoring.score&&(0,G.jsx)(we,{scoring:i.scoring,isMobile:pe}),i.comments&&i.comments.length>0&&(0,G.jsx)(x.A,{title:(0,G.jsxs)(G.Fragment,{children:[(0,G.jsx)(w.A,{})," \u4fee\u6539\u8bb0\u5f55"]}),type:"inner",children:(0,G.jsx)(f.A,{children:i.comments.map(((e,t)=>(0,G.jsx)(f.A.Item,{color:"#1890ff",children:(0,G.jsxs)("div",{style:{padding:"12px 16px",background:"#f9f9f9",borderRadius:"6px",marginBottom:"8px"},children:[(0,G.jsx)("p",{children:e.content}),(0,G.jsx)("div",{style:{textAlign:"right",color:"#888",fontSize:"12px"},children:e.createdAt?new Date(e.createdAt).toLocaleDateString():""})]})},t)))})}),i.revisionHistory&&i.revisionHistory.length>0&&(0,G.jsx)(x.A,{title:(0,G.jsxs)(G.Fragment,{children:[(0,G.jsx)(C.A,{})," \u4fee\u6539\u5386\u53f2"]}),type:"inner",children:(0,G.jsx)(f.A,{children:i.revisionHistory.map(((e,t)=>{var s;return(0,G.jsxs)(f.A.Item,{dot:(0,G.jsx)(C.A,{style:{fontSize:"16px"}}),children:[(0,G.jsxs)("div",{style:{marginBottom:"8px"},children:[(0,G.jsx)(Re,{strong:!0,children:(null===(s=e.modifiedBy)||void 0===s?void 0:s.name)||"\u672a\u77e5\u7528\u6237"})," \u4e8e"," ",e.modifiedAt?new Date(e.modifiedAt).toLocaleString():"\u672a\u77e5\u65f6\u95f4","\u4fee\u6539\u4e86\u5185\u5bb9"]}),(0,G.jsxs)("div",{style:{padding:"8px 12px",background:"#f9f9f9",borderRadius:"4px"},children:["\u4fee\u6539\u539f\u56e0: ",e.reason]})]},t)}))})}),i.implementationRecords&&i.implementationRecords.length>0&&(0,G.jsx)(x.A,{title:(0,G.jsx)(G.Fragment,{children:"\u5b9e\u65bd\u8bb0\u5f55"}),type:"inner",children:(0,G.jsx)(f.A,{children:i.implementationRecords.map(((e,t)=>{var s;return(0,G.jsxs)(f.A.Item,{color:"\u5df2\u5b8c\u6210"===e.status?"green":"\u5df2\u62d2\u7edd"===e.status?"red":"blue",children:[(0,G.jsxs)("div",{style:{marginBottom:"8px"},children:[(0,G.jsx)(Re,{strong:!0,children:(null===(s=e.updatedBy)||void 0===s?void 0:s.name)||"\u672a\u77e5\u7528\u6237"})," \u4e8e"," ",e.updatedAt?new Date(e.updatedAt).toLocaleString():"\u672a\u77e5\u65f6\u95f4","\u5c06\u72b6\u6001\u66f4\u65b0\u4e3a ",(0,G.jsx)(j.A,{color:E.STATUS_COLORS[e.status]||"default",style:{padding:"2px 8px",borderRadius:"4px"},children:E.SUGGESTION_STATUS[e.status]||e.status})]}),(0,G.jsxs)("div",{style:{padding:"8px 12px",background:"#f9f9f9",borderRadius:"4px"},children:["\u8bf4\u660e: ",e.comments]})]},t)}))})})]})})})]})}),(0,G.jsx)(o.A,{title:(0,G.jsxs)(G.Fragment,{children:[(0,G.jsx)(w.A,{})," \u6dfb\u52a0\u8bc4\u8bba"]}),open:O,onCancel:()=>M(!1),footer:null,width:pe?"95%":520,style:{borderRadius:"8px"},bodyStyle:{padding:pe?"16px":"24px"},children:(0,G.jsxs)(d.A,{form:Y,onFinish:Ge,layout:"vertical",children:[(0,G.jsx)(d.A.Item,{name:"content",rules:[{required:!0,message:"\u8bf7\u8f93\u5165\u8bc4\u8bba\u5185\u5bb9"}],children:(0,G.jsx)(Te,{rows:4,placeholder:"\u8bf7\u8f93\u5165\u60a8\u7684\u8bc4\u8bba...",style:{borderRadius:"4px"}})}),(0,G.jsxs)(d.A.Item,{style:{marginBottom:0,textAlign:"right"},children:[(0,G.jsx)(h.A,{onClick:()=>M(!1),style:{marginRight:"8px",borderRadius:"4px"},children:"\u53d6\u6d88"}),(0,G.jsx)(h.A,{type:"primary",htmlType:"submit",loading:ee,style:{borderRadius:"4px"},children:"\u63d0\u4ea4\u8bc4\u8bba"})]})]})}),(0,G.jsx)(o.A,{title:(0,G.jsxs)(G.Fragment,{children:[(0,G.jsx)(S.A,{})," \u4fee\u6539\u5efa\u8bae"]}),open:U,onCancel:()=>z(!1),footer:null,width:700,style:{borderRadius:"8px"},bodyStyle:{padding:"24px"},children:(0,G.jsxs)(d.A,{form:Z,onFinish:async e=>{try{se(!0),await L.O.updateSuggestion(t,{title:e.title,type:e.type,content:e.content,expectedBenefit:e.expectedBenefit,reason:e.reason}),a.Ay.success("\u5efa\u8bae\u4fee\u6539\u6210\u529f"),Z.resetFields(),z(!1),qe()}catch(s){console.error("\u4fee\u6539\u5efa\u8bae\u5931\u8d25:",s),a.Ay.error("\u4fee\u6539\u5efa\u8bae\u5931\u8d25")}finally{se(!1)}},layout:"vertical",children:[(0,G.jsx)(d.A.Item,{name:"title",label:"\u6807\u9898",rules:[{required:!0,message:"\u8bf7\u8f93\u5165\u6807\u9898"}],children:(0,G.jsx)(n.A,{style:{borderRadius:"4px"}})}),(0,G.jsx)(d.A.Item,{name:"type",label:"\u5efa\u8bae\u7c7b\u578b",rules:[{required:!0,message:"\u8bf7\u9009\u62e9\u5efa\u8bae\u7c7b\u578b"}],children:(0,G.jsx)(l.A,{placeholder:"\u8bf7\u9009\u62e9\u5efa\u8bae\u7c7b\u578b",style:{borderRadius:"4px"},children:Object.entries(E.SUGGESTION_TYPES).map((e=>{let[t,s]=e;return(0,G.jsx)(Ce,{value:t,children:s},t)}))})}),(0,G.jsx)(d.A.Item,{name:"content",label:"\u5185\u5bb9",rules:[{required:!0,message:"\u8bf7\u8f93\u5165\u5185\u5bb9"}],children:(0,G.jsx)(Te,{rows:6,style:{borderRadius:"4px"}})}),(0,G.jsx)(d.A.Item,{name:"expectedBenefit",label:"\u9884\u671f\u6548\u76ca",rules:[{required:!0,message:"\u8bf7\u8f93\u5165\u9884\u671f\u6548\u76ca"}],children:(0,G.jsx)(Te,{rows:4,style:{borderRadius:"4px"}})}),(0,G.jsx)(d.A.Item,{name:"reason",label:"\u4fee\u6539\u539f\u56e0",children:(0,G.jsx)(Te,{rows:2,style:{borderRadius:"4px"}})}),(0,G.jsxs)(d.A.Item,{style:{marginBottom:0,textAlign:"right"},children:[(0,G.jsx)(h.A,{onClick:()=>z(!1),style:{marginRight:"8px",borderRadius:"4px"},children:"\u53d6\u6d88"}),(0,G.jsx)(h.A,{type:"primary",htmlType:"submit",loading:ee,style:{borderRadius:"4px"},children:"\u63d0\u4ea4\u4fee\u6539"})]})]})}),(0,G.jsxs)(o.A,{title:(0,G.jsxs)(G.Fragment,{children:[(0,G.jsx)(R.A,{})," \u4e00\u7ea7\u5ba1\u6838"]}),open:$,onCancel:()=>_(!1),footer:null,width:600,style:{borderRadius:"8px"},bodyStyle:{padding:"24px"},children:[(0,G.jsx)(p.A,{message:"\u4e00\u7ea7\u5ba1\u6838\u63d0\u793a",description:"\u8bf7\u4ed4\u7ec6\u5ba1\u6838\u5efa\u8bae\u5185\u5bb9\uff0c\u786e\u8ba4\u662f\u5426\u901a\u8fc7\u4e00\u7ea7\u5ba1\u6838\u3002\u901a\u8fc7\u540e\u5c06\u8fdb\u5165\u4e8c\u7ea7\u5ba1\u6838\u6d41\u7a0b\u3002",type:"info",showIcon:!0,style:{marginBottom:"16px",borderRadius:"4px"}}),(0,G.jsxs)(d.A,{form:K,onFinish:async e=>{try{se(!0),console.log("\u63d0\u4ea4\u4e00\u7ea7\u5ba1\u6838:",{"\u5efa\u8baeID":t,"\u5ba1\u6838\u4eba":null===ie||void 0===ie?void 0:ie.name,"\u5ba1\u6838\u4eba\u89d2\u8272":null===ie||void 0===ie?void 0:ie.role,"\u5ba1\u6838\u4eba\u73ed\u7ec4":null===ie||void 0===ie?void 0:ie.team,"\u5ba1\u6838\u7ed3\u679c":"approve"===e.result?"\u901a\u8fc7":"\u62d2\u7edd","\u5ba1\u6838\u610f\u89c1":e.comment});const r={suggestionId:t,reviewType:"first",result:e.result,comment:e.comment,reviewerId:null===ie||void 0===ie?void 0:ie._id};await L.O.submitReview(r),a.Ay.success("\u4e00\u7ea7\u5ba1\u6838\u5b8c\u6210"),K.resetFields(),_(!1),qe(),window.history.length>1&&setTimeout((()=>{s("/suggestions/review")}),1500)}catch(n){var r,i;console.error("\u4e00\u7ea7\u5ba1\u6838\u5931\u8d25:",n),a.Ay.error("\u4e00\u7ea7\u5ba1\u6838\u5931\u8d25: "+((null===(r=n.response)||void 0===r||null===(i=r.data)||void 0===i?void 0:i.message)||n.message))}finally{se(!1)}},layout:"vertical",initialValues:{result:"approve"},children:[(0,G.jsx)(d.A.Item,{name:"result",label:"\u5ba1\u6838\u7ed3\u679c",rules:[{required:!0,message:"\u8bf7\u9009\u62e9\u5ba1\u6838\u7ed3\u679c"}],children:(0,G.jsxs)(A.Ay.Group,{children:[(0,G.jsx)(A.Ay.Button,{value:"approve",style:{borderRadius:"4px 0 0 4px"},children:"\u901a\u8fc7"}),(0,G.jsx)(A.Ay.Button,{value:"reject",style:{borderRadius:"0 4px 4px 0"},children:"\u62d2\u7edd"})]})}),(0,G.jsx)(d.A.Item,{name:"comment",label:"\u5ba1\u6838\u610f\u89c1",rules:[{required:!0,message:"\u8bf7\u8f93\u5165\u5ba1\u6838\u610f\u89c1"}],children:(0,G.jsx)(Te,{rows:4,placeholder:"\u8bf7\u8f93\u5165\u5ba1\u6838\u610f\u89c1...",style:{borderRadius:"4px"}})}),(0,G.jsxs)(d.A.Item,{style:{marginBottom:0,textAlign:"right"},children:[(0,G.jsx)(h.A,{onClick:()=>_(!1),style:{marginRight:"8px",borderRadius:"4px"},children:"\u53d6\u6d88"}),(0,G.jsx)(h.A,{type:"primary",htmlType:"submit",loading:ee,style:{borderRadius:"4px"},children:"\u63d0\u4ea4\u5ba1\u6838"})]})]})]}),(0,G.jsxs)(o.A,{title:(0,G.jsxs)(G.Fragment,{children:[(0,G.jsx)(R.A,{})," \u4e8c\u7ea7\u5ba1\u6838"]}),open:N,onCancel:()=>q(!1),footer:null,width:600,style:{borderRadius:"8px"},bodyStyle:{padding:"24px"},children:[(0,G.jsx)(p.A,{message:"\u4e8c\u7ea7\u5ba1\u6838\u63d0\u793a",description:"\u8bf7\u4ed4\u7ec6\u5ba1\u6838\u5efa\u8bae\u5185\u5bb9\uff0c\u786e\u8ba4\u662f\u5426\u6700\u7ec8\u901a\u8fc7\u3002\u901a\u8fc7\u540e\u5efa\u8bae\u5c06\u8fdb\u5165\u5b9e\u65bd\u6d41\u7a0b\uff0c\u5426\u5219\u5c06\u7ed3\u675f\u5904\u7406\u3002",type:"warning",showIcon:!0,style:{marginBottom:"16px",borderRadius:"4px"}}),(0,G.jsxs)(d.A,{form:Q,onFinish:async e=>{try{se(!0),console.log("\u63d0\u4ea4\u4e8c\u7ea7\u5ba1\u6838, \u53c2\u6570:",{id:t,result:e.result,comment:e.comment});const r={suggestionId:t,reviewType:"second",result:e.result,comment:e.comment,reviewerId:null===ie||void 0===ie?void 0:ie._id};await L.O.submitReview(r),a.Ay.success("\u4e8c\u7ea7\u5ba1\u6838\u5b8c\u6210"),Q.resetFields(),q(!1),qe(),window.history.length>1&&setTimeout((()=>{s("/suggestions/review")}),1500)}catch(n){var r,i;console.error("\u4e8c\u7ea7\u5ba1\u6838\u5931\u8d25:",n),a.Ay.error("\u4e8c\u7ea7\u5ba1\u6838\u5931\u8d25: "+((null===(r=n.response)||void 0===r||null===(i=r.data)||void 0===i?void 0:i.message)||n.message))}finally{se(!1)}},layout:"vertical",initialValues:{result:"approve"},children:[(0,G.jsx)(d.A.Item,{name:"result",label:"\u5ba1\u6838\u7ed3\u679c",rules:[{required:!0,message:"\u8bf7\u9009\u62e9\u5ba1\u6838\u7ed3\u679c"}],children:(0,G.jsxs)(A.Ay.Group,{children:[(0,G.jsx)(A.Ay.Button,{value:"approve",style:{borderRadius:"4px 0 0 4px"},children:"\u901a\u8fc7"}),(0,G.jsx)(A.Ay.Button,{value:"reject",style:{borderRadius:"0 4px 4px 0"},children:"\u62d2\u7edd"})]})}),(0,G.jsx)(d.A.Item,{name:"comment",label:"\u5ba1\u6838\u610f\u89c1",rules:[{required:!0,message:"\u8bf7\u8f93\u5165\u5ba1\u6838\u610f\u89c1"}],children:(0,G.jsx)(Te,{rows:4,placeholder:"\u8bf7\u8f93\u5165\u5ba1\u6838\u610f\u89c1...",style:{borderRadius:"4px"}})}),(0,G.jsxs)(d.A.Item,{style:{marginBottom:0,textAlign:"right"},children:[(0,G.jsx)(h.A,{onClick:()=>q(!1),style:{marginRight:"8px",borderRadius:"4px"},children:"\u53d6\u6d88"}),(0,G.jsx)(h.A,{type:"primary",htmlType:"submit",loading:ee,style:{borderRadius:"4px"},children:"\u63d0\u4ea4\u5ba1\u6838"})]})]})]}),(0,G.jsxs)(o.A,{title:void 0!==(null===i||void 0===i||null===(e=i.scoring)||void 0===e?void 0:e.score)?"\u4fee\u6539\u5efa\u8bae\u8bc4\u5206":"\u4e3a\u5efa\u8bae\u8bc4\u5206",open:H,onCancel:()=>V(!1),onOk:async()=>{const e=await X.validateFields(),s=parseFloat(e.score);isNaN(s)||s<.5||s>5?a.Ay.error("\u8bf7\u8f93\u5165 0.5 \u5230 5 \u4e4b\u95f4\u7684\u6709\u6548\u5206\u6570"):(await L.O.scoreSuggestion(t,s),a.Ay.success("\u8bc4\u5206\u6210\u529f"),V(!1),qe())},okText:"\u63d0\u4ea4\u8bc4\u5206",cancelText:"\u53d6\u6d88",children:[(0,G.jsx)(p.A,{message:"\u8bc4\u5206\u63d0\u793a",description:"\u8bf7\u6839\u636e\u4ee5\u4e0b\u6807\u51c6\u8bc4\u5206\uff1a\u521b\u65b0\u6027\u3001\u5b9e\u7528\u6027\u3001\u6548\u76ca\u6027\u3001\u5b8c\u6574\u6027\u3001\u53ef\u884c\u6027\u3002\u6700\u5c0f\u8bc4\u5206\u5355\u4f4d0.5\u5206\u3002",type:"info",showIcon:!0,style:{marginBottom:"16px",borderRadius:"4px"}}),(0,G.jsx)(d.A,{form:X,layout:"vertical",name:"score_form",children:(0,G.jsx)(d.A.Item,{name:"score",label:"\u5206\u6570 (0.5-5)",rules:[{required:!0,message:"\u8bf7\u8f93\u5165\u5206\u6570"},{validator:(e,t)=>{const s=parseFloat(t);return isNaN(s)||s<.5||s>5?Promise.reject(new Error("\u5206\u6570\u5fc5\u987b\u5728 0.5 \u5230 5 \u4e4b\u95f4")):10*s%5!==0?Promise.reject(new Error("\u5206\u6570\u5fc5\u987b\u662f0.5\u7684\u500d\u6570")):Promise.resolve()}}],children:(0,G.jsx)(n.A,{type:"number",min:.5,max:5,step:.5,placeholder:"\u8bf7\u8f93\u5165 0.5-5 \u4e4b\u95f4\u7684\u5206\u6570 (\u4f8b\u5982: 3.5)"})})})]}),(0,G.jsx)(J,{visible:de,onClose:()=>ae(!1),filename:null===ce||void 0===ce?void 0:ce.filename})]})}},81015:(e,t,s)=>{"use strict";s.d(t,{q:()=>i});var r=s(19119);const i=e=>{if(!e)return"";const t=e.reviewStatus||e.status;if("string"===typeof t&&/[\u4e00-\u9fa5]/.test(t)){const e=Object.entries(r.REVIEW_STATUS).find((e=>{let[s,r]=e;return r===t}));return e?e[0]:t}return t}},82787:()=>{},97492:()=>{}}]);
//# sourceMappingURL=207.9c229a21.chunk.js.map